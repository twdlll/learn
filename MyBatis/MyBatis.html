<!DOCTYPE html>
<!-- saved from url=(0016)http://localhost -->
<html>
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>MyBatis</title>
    <style>
        body{
            margin: 0;
        }
        #content-info{
            width: auto;
            margin: 0 auto;
            text-align: center;
        }
        #author-info{
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }
        #title{
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            padding-top: 10px;
            margin-bottom: 2px;
            font-size: 34px;
            color: #505050;
        }
        .text{
            white-space:nowrap;
            text-overflow: ellipsis;
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 2px;
            font-size: 20px;
            color: #8c8c8c;
        }
        #navBar{
            width: auto;
            height: auto;
            position: fixed;
            right:0;
            bottom: 0;
            background-color: #f0f3f4;
            overflow-y: auto;
            text-align: center;
        }
        #svg-container{
            width: 100%;
            overflow-x: scroll;
            min-width: 0px;
            margin: 0 10px;
        }
        #nav-thumbs{
            overflow-y: scroll;
            padding: 0 5px;
        }
        .nav-thumb{
            position: relative;
            margin: 10px auto;
        }
        .nav-thumb >p{
            text-align: center;
            font-size: 12px;
            margin: 4px 0 0 0;
        }
        .nav-thumb >div{
            position: relative;
            display: inline-block;
            border: 1px solid #c6cfd5;
        }
        .nav-thumb img{
            display: block;
        }
        #main-content{
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #d0cfd8;
            display: flex;
            height: auto;
            flex-flow: row wrap;
            text-align:center;
        }
        #svg-container >svg{
            display: block;
            margin:10px auto;
            margin-bottom: 0;
        }
        #copyright{
            bottom: 0;
            left: 50%;
            margin: 5px auto;
            font-size: 16px;
            color: #515151;
        }
        #copyright >a{
            text-decoration: none;
            color: #77C;
        }
        .number{
            position: absolute;
            top:0;
            left:0;
            border-top:22px solid #08a1ef;
            border-right: 22px solid transparent;
        }
        .pagenum{
            font-size: 12px;
            color: #fff;
            position: absolute;
            top: -23px;
            left: 2px;
        }
            #navBar::-webkit-scrollbar{
            width: 8px;
            background-color: #f5f5f5;
        }
            #navBar::-webkit-scrollbar-track{
            -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,.3);
            border-radius: 8px;
            background-color: #fff;
        }
            #navBar::-webkit-scrollbar-thumb{
            border-radius: 8px;
            -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,.3);
            background-color: #6b6b70;
        }
        #navBar::-webkit-scrollbar-thumb:hover{
            background-color: #4a4a4f;
        }
</style>
  </head>
  <body>
    <div id="main-area">
      <div id="main-content">
        <div id="svg-container"><svg xmlns:xlink="http://www.w3.org/1999/xlink" height="496" ed:name="Page-1" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:ed="https://www.edrawsoft.cn/xml/2017/SVGExtensions/" ed:hSpacing="30" width="1041" ed:vSpacing="30" viewBox="0 0 1041 496" id="page1" preserveAspectRadio="xMinYMin meet">
    <style type="text/css"><![CDATA[
g[ed\:togtopicid],g[ed\:hyperlink],g[ed\:comment],g[ed\:note] {cursor:pointer;}
g[id] {-moz-user-select: none;-ms-user-select: none;user-select: none;}
svg text::selection,svg tspan::selection{background-color: #4285f4;color: #ffffff;fill: #ffffff;}
.st38 {fill:#454545;font-family:Consolas;font-size:10pt}
.st37 {fill:#454545;font-family:Consolas;font-size:12pt}
.st36 {fill:#454545;font-family:Consolas;font-size:14pt}
.st39 {fill:#ffffff;font-family:Consolas;font-size:11pt}
]]></style>
    <defs>
        <linearGradient y2="100%" y1="0%" x1="0%" x2="0%" id="lg11">
            <stop offset="0" stop-color="#ffffff"/>
            <stop offset="0.25" stop-color="#f0f5f0"/>
            <stop offset="0.75" stop-color="#e1ebe1"/>
            <stop offset="1" stop-color="#c8d7c8"/>
        </linearGradient>
    </defs>
    <rect height="496" y="0" x="0" width="1041" fill="#fbfcfb"/>
    <path stroke-linejoin="round" stroke="#5fb7f1" ed:parentid="101" d="M-23.1,35.3C-24.1,36.8,-23.8,38.4,-22.7,39.2C-21.5,39.9,-19.9,39.5,-18.9,38C-17.7,35.9,-16.5,33.9,-15.3,31.8C-14.2,29.8,-13.1,27.7,-12,25.5C-11,23.4,-10,21.3,-9,19.2C-8,17,-7,14.9,-6.1,12.8C-5.1,10.6,-4.2,8.5,-3.2,6.3C-2.3,4.2,-1.4,2.1,-0.4,-0.1C0.5,-2.2,1.4,-4.3,2.4,-6.5C3.3,-8.6,4.3,-10.7,5.3,-12.8C6.2,-14.9,7.2,-17,8.3,-19.1C9.3,-21.2,10.4,-23.2,11.5,-25.3C12.6,-27.3,13.7,-29.3,14.9,-31.3C16.1,-33.2,17.4,-35.2,18.7,-37.1C20,-39,21.4,-40.8,22.8,-42.6C24.3,-44.4,25.8,-46.1,27.4,-47.7C29.1,-49.3,30.8,-50.8,32.6,-52.2C34.4,-53.7,36.3,-55,38.3,-56.1C40.3,-57.3,42.3,-58.3,44.4,-59.1C46.5,-60,48.7,-60.7,51,-61.2C53.3,-61.7,55.9,-62.1,57.8,-62.3C59.8,-62.5,61.1,-62.5,62.5,-62.6C62.8,-62.6,63.1,-62.8,63.1,-63.1C63.1,-63.4,62.8,-63.6,62.5,-63.6C61.1,-63.6,59.7,-63.6,57.7,-63.5C55.7,-63.3,53.1,-63,50.7,-62.5C48.3,-62,46.1,-61.4,43.9,-60.6C41.7,-59.8,39.5,-58.8,37.4,-57.6C35.3,-56.5,33.3,-55.2,31.4,-53.8C29.5,-52.4,27.7,-50.9,25.9,-49.2C24.2,-47.6,22.6,-45.9,21,-44.1C19.5,-42.3,18,-40.5,16.6,-38.6C15.2,-36.7,13.8,-34.7,12.6,-32.7C11.3,-30.8,10.1,-28.7,8.9,-26.7C7.7,-24.7,6.6,-22.6,5.4,-20.5C4.3,-18.5,3.3,-16.4,2.2,-14.3C1.2,-12.2,0.1,-10.1,-0.9,-8C-1.9,-5.9,-2.9,-3.7,-3.9,-1.6C-4.9,0.5,-5.9,2.6,-6.9,4.7C-7.9,6.8,-8.9,8.9,-9.9,11C-10.9,13.1,-11.9,15.2,-12.9,17.3C-14,19.3,-15,21.4,-16.1,23.4C-17.2,25.5,-18.3,27.5,-19.5,29.4C-20.7,31.4,-21.9,33.3,-23.1,35.3z" stroke-linecap="round" transform="matrix(1,0,0,1,677,185)" id="102" ed:tosuperid="112" fill="#5fb7f1"/>
    <path stroke-linejoin="round" stroke="#ff7575" ed:parentid="101" d="M-28.7,68C-29.5,69.6,-29,71.2,-27.8,71.8C-26.6,72.4,-25,71.8,-24.2,70.2C-23.2,68,-22.3,65.8,-21.4,63.6C-20.4,61.4,-19.6,59.2,-18.8,57C-18,54.8,-17.3,52.5,-16.6,50.3C-15.9,48,-15.2,45.8,-14.6,43.5C-13.9,41.2,-13.3,39,-12.7,36.7C-12.1,34.4,-11.6,32.2,-11,29.9C-10.5,27.6,-9.9,25.3,-9.4,23.1C-8.9,20.8,-8.3,18.5,-7.8,16.2C-7.3,13.9,-6.8,11.7,-6.3,9.4C-5.8,7.1,-5.3,4.8,-4.7,2.6C-4.2,0.3,-3.7,-2,-3.2,-4.3C-2.7,-6.5,-2.1,-8.8,-1.6,-11.1C-1.1,-13.3,-0.5,-15.6,0.1,-17.8C0.6,-20.1,1.2,-22.4,1.8,-24.6C2.4,-26.8,3,-29.1,3.7,-31.3C4.3,-33.5,5,-35.8,5.7,-38C6.4,-40.2,7.1,-42.4,7.9,-44.6C8.6,-46.8,9.4,-48.9,10.3,-51.1C11.2,-53.3,12,-55.4,13,-57.5C14,-59.6,15,-61.7,16,-63.7C17.1,-65.8,18.2,-67.8,19.5,-69.7C20.7,-71.7,22,-73.6,23.4,-75.4C24.7,-77.3,26.2,-79.1,27.8,-80.7C29.4,-82.4,31,-84,32.8,-85.4C34.6,-86.9,36.5,-88.2,38.4,-89.4C40.4,-90.6,42.5,-91.6,44.6,-92.5C46.7,-93.3,48.8,-94,51.2,-94.5C53.5,-95.1,56.1,-95.4,58,-95.6C59.9,-95.8,61.2,-95.8,62.5,-95.8C62.8,-95.9,63.1,-96.1,63.1,-96.3C63.1,-96.6,62.8,-96.8,62.5,-96.8C61.2,-96.9,59.9,-96.9,57.9,-96.7C56,-96.6,53.3,-96.2,50.9,-95.7C48.5,-95.2,46.3,-94.6,44.1,-93.7C41.9,-92.9,39.7,-91.9,37.7,-90.7C35.6,-89.5,33.6,-88.2,31.8,-86.7C29.9,-85.3,28.2,-83.7,26.5,-82C24.8,-80.3,23.3,-78.5,21.8,-76.6C20.4,-74.8,19,-72.8,17.7,-70.8C16.4,-68.9,15.2,-66.8,14.1,-64.8C13,-62.7,11.9,-60.6,10.9,-58.5C9.9,-56.4,8.9,-54.2,8,-52C7.1,-49.9,6.2,-47.7,5.4,-45.5C4.6,-43.3,3.8,-41.1,3,-38.8C2.3,-36.6,1.6,-34.4,0.9,-32.2C0.2,-29.9,-0.5,-27.7,-1.1,-25.4C-1.8,-23.2,-2.4,-20.9,-3,-18.7C-3.6,-16.4,-4.2,-14.1,-4.8,-11.9C-5.4,-9.6,-6,-7.3,-6.6,-5.1C-7.1,-2.8,-7.7,-0.5,-8.2,1.7C-8.8,4,-9.4,6.3,-9.9,8.5C-10.5,10.8,-11,13.1,-11.6,15.3C-12.2,17.6,-12.7,19.8,-13.3,22.1C-13.9,24.4,-14.5,26.6,-15.1,28.9C-15.6,31.1,-16.3,33.3,-16.9,35.6C-17.5,37.8,-18.2,40,-18.8,42.2C-19.5,44.5,-20.2,46.7,-21,48.9C-21.7,51,-22.5,53.2,-23.3,55.4C-24.1,57.5,-24.9,59.7,-25.8,61.8C-26.7,63.9,-27.7,65.9,-28.7,68z" stroke-linecap="round" transform="matrix(1,0,0,1,677,152)" id="103" ed:tosuperid="113" fill="#ff7575"/>
    <path stroke-linejoin="round" stroke="#fa8556" ed:parentid="101" d="M-25.9,-86.9C-26.6,-88.5,-28.1,-89.1,-29.4,-88.6C-30.6,-88,-31.1,-86.4,-30.4,-84.8C-29.5,-82.7,-28.6,-80.6,-27.7,-78.5C-26.9,-76.4,-26.1,-74.2,-25.4,-72C-24.6,-69.8,-23.9,-67.6,-23.3,-65.4C-22.6,-63.2,-22,-61,-21.4,-58.8C-20.8,-56.5,-20.2,-54.3,-19.7,-52C-19.1,-49.8,-18.6,-47.5,-18.1,-45.2C-17.6,-43,-17.1,-40.7,-16.7,-38.4C-16.2,-36.2,-15.7,-33.9,-15.3,-31.6C-14.8,-29.3,-14.4,-27,-13.9,-24.7C-13.5,-22.4,-13.1,-20.2,-12.6,-17.9C-12.2,-15.6,-11.8,-13.3,-11.4,-11C-10.9,-8.7,-10.5,-6.4,-10.1,-4.1C-9.7,-1.8,-9.2,0.5,-8.8,2.8C-8.4,5.1,-7.9,7.4,-7.5,9.7C-7,12,-6.6,14.3,-6.1,16.6C-5.6,18.8,-5.2,21.1,-4.7,23.4C-4.2,25.7,-3.7,28,-3.2,30.3C-2.6,32.6,-2.1,34.8,-1.5,37.1C-1,39.4,-0.4,41.7,0.2,43.9C0.8,46.2,1.5,48.4,2.1,50.7C2.8,52.9,3.5,55.2,4.2,57.4C4.9,59.6,5.7,61.9,6.5,64.1C7.3,66.3,8.2,68.5,9.1,70.6C10,72.8,11,74.9,12,77.1C13,79.2,14.1,81.3,15.3,83.3C16.4,85.4,17.7,87.4,19,89.3C20.3,91.3,21.7,93.2,23.2,95C24.8,96.8,26.4,98.6,28.1,100.2C29.8,101.8,31.6,103.4,33.5,104.8C35.5,106.1,37.5,107.4,39.6,108.5C41.7,109.6,43.9,110.5,46.1,111.2C48.3,111.9,50.5,112.5,53,112.9C55.5,113.3,58.4,113.5,60.1,113.6C61.7,113.7,62.1,113.7,62.5,113.6C62.8,113.6,63.1,113.4,63.1,113.1C63.1,112.8,62.8,112.6,62.5,112.6C62.1,112.6,61.7,112.7,60.1,112.6C58.5,112.4,55.7,112.2,53.2,111.8C50.8,111.3,48.7,110.7,46.5,110C44.4,109.2,42.3,108.3,40.2,107.2C38.2,106.1,36.3,104.9,34.4,103.5C32.6,102.2,30.9,100.6,29.2,99C27.6,97.4,26,95.7,24.6,93.9C23.2,92.1,21.8,90.2,20.6,88.3C19.3,86.4,18.1,84.4,17,82.3C15.9,80.3,14.9,78.3,13.9,76.2C12.9,74.1,12,71.9,11.2,69.8C10.3,67.6,9.5,65.5,8.7,63.3C8,61.1,7.3,58.9,6.6,56.7C5.9,54.4,5.2,52.2,4.6,50C4,47.7,3.4,45.5,2.8,43.2C2.3,41,1.7,38.7,1.2,36.5C0.7,34.2,0.2,31.9,-0.3,29.6C-0.7,27.4,-1.2,25.1,-1.7,22.8C-2.1,20.5,-2.5,18.2,-3,15.9C-3.4,13.7,-3.8,11.4,-4.2,9.1C-4.6,6.8,-5,4.5,-5.4,2.2C-5.8,-0.1,-6.2,-2.4,-6.6,-4.7C-7,-7,-7.3,-9.3,-7.7,-11.6C-8.1,-13.9,-8.5,-16.2,-8.9,-18.5C-9.3,-20.8,-9.7,-23.1,-10.1,-25.4C-10.5,-27.7,-10.9,-30,-11.3,-32.3C-11.7,-34.6,-12.1,-36.9,-12.6,-39.2C-13,-41.5,-13.5,-43.8,-13.9,-46.1C-14.4,-48.4,-14.9,-50.7,-15.4,-53C-15.9,-55.3,-16.5,-57.6,-17,-59.9C-17.6,-62.2,-18.2,-64.5,-18.8,-66.7C-19.4,-69,-20.1,-71.3,-20.8,-73.5C-21.6,-75.8,-22.3,-78,-23.2,-80.2C-24,-82.5,-24.9,-84.7,-25.9,-86.9z" stroke-linecap="round" transform="matrix(1,0,0,1,677,361)" id="104" ed:tosuperid="114" fill="#fa8556"/>
    <path stroke-linejoin="round" stroke="#f1a3dc" ed:parentid="101" d="M-1,-3.6C-2.7,-4,-4.2,-3.1,-4.4,-1.7C-4.7,-0.4,-3.8,1,-2,1.3C0.3,1.7,2.6,2.2,4.9,2.6C7.1,3,9.4,3.4,11.7,3.8C14,4.3,16.3,4.7,18.7,5.1C21,5.5,23.3,5.9,25.6,6.2C27.9,6.6,30.2,6.9,32.6,7.2C34.9,7.5,37.2,7.8,39.6,8C41.9,8.3,44.3,8.5,46.6,8.6C48.9,8.8,51,8.9,53.6,8.9C56.2,9,59.1,8.9,60.6,8.9C62.2,8.9,62.3,8.9,62.5,8.9C62.8,8.8,63.1,8.7,63.1,8.4C63.1,8.1,62.8,7.9,62.5,7.9C62.3,7.9,62.2,7.9,60.7,7.8C59.1,7.7,56.2,7.6,53.7,7.4C51.2,7.2,49,6.9,46.8,6.6C44.5,6.3,42.2,6,39.9,5.6C37.6,5.3,35.3,4.9,33,4.4C30.7,4,28.5,3.5,26.2,3C23.9,2.5,21.7,2,19.4,1.4C17.1,0.9,14.9,0.4,12.6,-0.2C10.3,-0.8,8.1,-1.3,5.8,-1.9C3.5,-2.4,1.3,-3,-1,-3.6z" stroke-linecap="round" transform="matrix(1,0,0,1,677,257)" id="105" ed:tosuperid="115" fill="#f1a3dc"/>
    <path stroke-linejoin="round" stroke="#6cc9e5" ed:parentid="101" d="M-14.5,-23.3C-15.6,-24.8,-17.3,-24.9,-18.4,-24.1C-19.4,-23.2,-19.5,-21.6,-18.4,-20.2C-16.9,-18.4,-15.4,-16.6,-14,-14.8C-12.6,-13,-11.2,-11.2,-9.8,-9.3C-8.5,-7.4,-7.1,-5.5,-5.8,-3.6C-4.4,-1.7,-3.1,0.2,-1.7,2.1C-0.4,4,1,5.9,2.3,7.8C3.7,9.7,5.1,11.6,6.5,13.5C7.9,15.3,9.4,17.2,10.9,19C12.4,20.9,13.9,22.6,15.5,24.4C17.1,26.2,18.7,27.9,20.4,29.5C22.1,31.2,23.9,32.7,25.7,34.2C27.6,35.7,29.5,37.1,31.5,38.4C33.5,39.7,35.6,40.8,37.7,41.9C39.9,42.9,42.1,43.8,44.3,44.5C46.6,45.2,48.8,45.8,51.2,46.2C53.7,46.6,56.3,46.9,58.3,47C60.2,47.1,61.3,47.1,62.5,47.1C62.8,47.1,63.1,46.8,63.1,46.6C63.1,46.3,62.8,46.1,62.5,46.1C61.3,46.1,60.2,46,58.3,45.9C56.5,45.7,53.9,45.3,51.5,44.8C49.1,44.3,47,43.7,44.9,42.9C42.7,42.1,40.6,41.2,38.6,40.1C36.5,39.1,34.6,37.9,32.7,36.6C30.8,35.3,29,33.9,27.3,32.4C25.6,30.8,23.9,29.3,22.3,27.6C20.7,25.9,19.2,24.2,17.7,22.5C16.2,20.7,14.8,18.9,13.4,17C12,15.2,10.6,13.3,9.3,11.4C8,9.5,6.7,7.6,5.4,5.7C4.1,3.7,2.8,1.8,1.6,-0.2C0.3,-2.1,-1,-4.1,-2.3,-6C-3.6,-8,-4.8,-9.9,-6.2,-11.9C-7.5,-13.8,-8.8,-15.8,-10.2,-17.7C-11.6,-19.6,-13.1,-21.5,-14.5,-23.3z" stroke-linecap="round" transform="matrix(1,0,0,1,677,295)" id="106" ed:tosuperid="116" fill="#6cc9e5"/>
    <path stroke-linejoin="round" stroke="#ffcd55" ed:parentid="101" d="M-11.4,7.3C-12.9,8.4,-13.1,10,-12.2,11.1C-11.4,12.2,-9.7,12.4,-8.3,11.2C-6.5,9.7,-4.7,8.1,-3,6.6C-1.2,5,0.5,3.5,2.3,1.9C4,0.4,5.8,-1.2,7.5,-2.7C9.2,-4.3,11,-5.8,12.7,-7.3C14.5,-8.8,16.3,-10.3,18.1,-11.7C19.9,-13.2,21.8,-14.5,23.6,-15.9C25.5,-17.2,27.4,-18.4,29.4,-19.6C31.4,-20.8,33.4,-21.9,35.5,-22.9C37.6,-23.9,39.7,-24.7,41.8,-25.5C44,-26.3,46.2,-27,48.5,-27.5C50.7,-28,52.9,-28.5,55.3,-28.8C57.6,-29,60,-29.2,62.5,-29.3C62.8,-29.3,63.1,-29.5,63.1,-29.8C63.1,-30.1,62.8,-30.3,62.5,-30.3C60,-30.3,57.5,-30.3,55.1,-30.1C52.7,-29.9,50.4,-29.6,48.1,-29.1C45.8,-28.7,43.5,-28.1,41.2,-27.4C38.9,-26.7,36.7,-25.9,34.5,-25C32.3,-24.1,30.2,-23,28.1,-21.9C26,-20.8,24,-19.6,22,-18.4C20,-17.1,18,-15.8,16.1,-14.4C14.2,-13,12.3,-11.6,10.4,-10.2C8.6,-8.7,6.7,-7.3,4.9,-5.8C3.1,-4.3,1.3,-2.8,-0.5,-1.4C-2.3,0.1,-4.1,1.6,-6,3C-7.8,4.5,-9.6,5.9,-11.4,7.3z" stroke-linecap="round" transform="matrix(1,0,0,1,677,218)" id="107" ed:tosuperid="117" fill="#ffcd55"/>
    <path stroke-linejoin="round" stroke="#f1a3dc" ed:parentid="115" stroke-linecap="round" d="M-13.5,10C-0.4,10,-0,-10,13.5,-10" transform="matrix(1,0,0,1,874,255)" stroke-width="2" id="108" ed:tosuperid="118" fill="none"/>
    <path stroke-linejoin="round" stroke="#f1a3dc" ed:parentid="115" stroke-linecap="round" d="M-13.5,-4.9C-1.5,-4.9,2.7,4.9,13.5,4.9" transform="matrix(1,0,0,1,874,270)" stroke-width="2" id="109" ed:tosuperid="119" fill="none"/>
    <path stroke-linejoin="round" stroke="#80cf70" ed:parentid="101" d="M-22.1,-54C-22.9,-55.6,-24.5,-56.1,-25.7,-55.4C-26.9,-54.8,-27.3,-53.2,-26.4,-51.6C-25.4,-49.6,-24.3,-47.6,-23.3,-45.5C-22.3,-43.5,-21.3,-41.4,-20.4,-39.2C-19.5,-37.1,-18.6,-35,-17.7,-32.8C-16.9,-30.7,-16.1,-28.5,-15.3,-26.4C-14.5,-24.2,-13.7,-22,-12.9,-19.8C-12.2,-17.6,-11.4,-15.4,-10.7,-13.2C-9.9,-11,-9.2,-8.8,-8.4,-6.6C-7.7,-4.3,-7,-2.1,-6.2,0.1C-5.5,2.3,-4.8,4.5,-4,6.7C-3.2,8.9,-2.5,11.2,-1.7,13.4C-0.9,15.6,-0.1,17.8,0.7,20C1.5,22.2,2.3,24.4,3.2,26.5C4.1,28.7,5,30.9,5.9,33C6.8,35.2,7.8,37.3,8.8,39.5C9.8,41.6,10.9,43.7,12,45.8C13.2,47.8,14.4,49.9,15.6,51.9C16.9,53.9,18.2,55.8,19.6,57.7C21,59.6,22.5,61.5,24.1,63.2C25.7,65,27.4,66.7,29.1,68.2C30.9,69.8,32.8,71.2,34.8,72.5C36.8,73.8,38.8,75,41,76C43.2,77,45.4,77.8,47.7,78.5C49.9,79.1,52.2,79.6,54.6,79.9C57.1,80.2,59.8,80.3,62.5,80.4C62.8,80.4,63.1,80.1,63.1,79.8C63.1,79.6,62.8,79.4,62.5,79.3C59.8,79.2,57.2,79.1,54.8,78.7C52.4,78.4,50.2,77.9,48.1,77.2C45.9,76.5,43.7,75.6,41.7,74.6C39.6,73.6,37.6,72.5,35.7,71.1C33.9,69.8,32.1,68.4,30.4,66.8C28.7,65.3,27.1,63.6,25.6,61.9C24.1,60.1,22.7,58.3,21.4,56.4C20,54.6,18.8,52.6,17.6,50.6C16.4,48.7,15.3,46.6,14.3,44.6C13.2,42.5,12.2,40.4,11.3,38.3C10.3,36.2,9.4,34.1,8.5,31.9C7.6,29.8,6.8,27.6,6,25.5C5.2,23.3,4.4,21.1,3.7,18.9C2.9,16.7,2.2,14.5,1.5,12.3C0.7,10.1,0,7.9,-0.7,5.6C-1.4,3.4,-2.1,1.2,-2.7,-1C-3.4,-3.3,-4.1,-5.5,-4.8,-7.7C-5.5,-10,-6.2,-12.2,-6.9,-14.4C-7.5,-16.7,-8.2,-18.9,-9,-21.1C-9.7,-23.4,-10.4,-25.6,-11.2,-27.8C-11.9,-30,-12.7,-32.2,-13.5,-34.5C-14.3,-36.7,-15.2,-38.9,-16.1,-41.1C-17,-43.2,-17.9,-45.4,-18.9,-47.6C-19.9,-49.7,-21,-51.9,-22.1,-54z" stroke-linecap="round" transform="matrix(1,0,0,1,677,328)" id="110" ed:tosuperid="120" fill="#80cf70"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="101" d="M22.3,-32.2C23.3,-33.7,23.1,-35.3,21.9,-36C20.8,-36.8,19.1,-36.5,18.2,-34.9C16.9,-32.9,15.7,-30.9,14.5,-28.9C13.3,-26.8,12.1,-24.7,11,-22.6C10,-20.6,8.9,-18.5,7.8,-16.4C6.8,-14.3,5.8,-12.1,4.8,-10C3.8,-7.9,2.8,-5.8,1.8,-3.7C0.8,-1.6,-0.2,0.5,-1.2,2.7C-2.2,4.8,-3.2,6.9,-4.2,8.9C-5.2,11,-6.2,13.1,-7.3,15.2C-8.4,17.2,-9.4,19.3,-10.6,21.3C-11.7,23.3,-12.9,25.3,-14.1,27.3C-15.3,29.3,-16.5,31.2,-17.9,33.1C-19.2,35,-20.6,36.8,-22,38.6C-23.5,40.4,-25,42.1,-26.6,43.7C-28.2,45.4,-29.9,46.9,-31.7,48.4C-33.5,49.8,-35.3,51.1,-37.3,52.3C-39.3,53.5,-41.3,54.5,-43.4,55.4C-45.5,56.3,-47.7,57.1,-49.9,57.6C-52.2,58.2,-54.6,58.7,-56.7,58.9C-58.8,59.2,-60.7,59.2,-62.5,59.3C-62.8,59.3,-63.1,59.5,-63.1,59.8C-63.1,60.1,-62.8,60.3,-62.5,60.3C-60.6,60.3,-58.8,60.3,-56.6,60.1C-54.5,59.9,-52,59.5,-49.6,59C-47.3,58.5,-45,57.8,-42.8,56.9C-40.6,56.1,-38.5,55,-36.4,53.9C-34.3,52.7,-32.3,51.4,-30.4,50C-28.6,48.5,-26.7,47,-25,45.3C-23.3,43.7,-21.7,42,-20.1,40.2C-18.6,38.4,-17.1,36.5,-15.7,34.6C-14.3,32.7,-12.9,30.8,-11.6,28.8C-10.3,26.9,-9.1,24.9,-7.9,22.8C-6.7,20.8,-5.5,18.8,-4.4,16.7C-3.3,14.7,-2.1,12.6,-1.1,10.5C0,8.5,1.1,6.4,2.2,4.3C3.2,2.2,4.3,0.1,5.3,-2C6.4,-4,7.4,-6.1,8.5,-8.2C9.6,-10.3,10.6,-12.3,11.7,-14.4C12.8,-16.4,13.9,-18.4,15.1,-20.5C16.2,-22.5,17.4,-24.5,18.6,-26.4C19.8,-28.4,21.1,-30.3,22.3,-32.2z" stroke-linecap="round" transform="matrix(1,0,0,1,552,308)" id="124" ed:tosuperid="123" fill="#a98ae7"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,38.7C-4.6,38.7,11.6,-38.7,-13.5,-38.7" transform="matrix(1,0,0,1,355,329)" stroke-width="2" id="129" ed:tosuperid="128" fill="none"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,24.5C-2.6,24.5,7,-24.5,-13.5,-24.5" transform="matrix(1,0,0,1,355,343)" stroke-width="2" id="131" ed:tosuperid="130" fill="none"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,10.4C0.3,10.4,0.2,-10.4,-13.5,-10.4" transform="matrix(1,0,0,1,355,357)" stroke-width="2" id="133" ed:tosuperid="132" fill="none"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,-3.7C1.8,-3.7,-3.4,3.7,-13.5,3.7" transform="matrix(1,0,0,1,355,372)" stroke-width="2" id="135" ed:tosuperid="134" fill="none"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,-17.8C-1.3,-17.8,4,17.8,-13.5,17.8" transform="matrix(1,0,0,1,355,386)" stroke-width="2" id="137" ed:tosuperid="136" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="101" d="M12.6,18.9C13.8,20.3,15.5,20.3,16.5,19.4C17.5,18.5,17.5,16.8,16.3,15.5C14.7,13.8,13.2,12.1,11.6,10.4C10.1,8.7,8.6,6.9,7.1,5.2C5.6,3.4,4.1,1.6,2.6,-0.2C1.1,-2,-0.4,-3.8,-1.9,-5.6C-3.4,-7.4,-4.9,-9.2,-6.4,-10.9C-8,-12.7,-9.5,-14.5,-11.1,-16.2C-12.7,-17.9,-14.4,-19.6,-16.1,-21.3C-17.8,-22.9,-19.5,-24.5,-21.3,-26C-23.1,-27.6,-25,-29,-27,-30.4C-28.9,-31.8,-30.9,-33.1,-33,-34.2C-35,-35.4,-37.2,-36.4,-39.4,-37.3C-41.6,-38.2,-43.9,-39,-46.1,-39.6C-48.4,-40.2,-50.5,-40.7,-53.1,-41C-55.6,-41.3,-58.5,-41.5,-60.1,-41.5C-61.7,-41.6,-62.1,-41.5,-62.5,-41.5C-62.8,-41.5,-63.1,-41.3,-63.1,-41C-63.1,-40.7,-62.8,-40.5,-62.5,-40.5C-62.1,-40.5,-61.8,-40.5,-60.2,-40.4C-58.6,-40.3,-55.7,-40,-53.3,-39.6C-50.8,-39.2,-48.7,-38.7,-46.6,-38C-44.4,-37.3,-42.2,-36.5,-40.1,-35.5C-38,-34.6,-36,-33.5,-34.1,-32.3C-32.1,-31.1,-30.2,-29.8,-28.4,-28.4C-26.6,-27,-24.9,-25.5,-23.2,-24C-21.5,-22.4,-19.8,-20.8,-18.3,-19.1C-16.7,-17.4,-15.1,-15.7,-13.6,-14C-12.1,-12.2,-10.6,-10.4,-9.2,-8.6C-7.7,-6.8,-6.3,-5,-4.9,-3.1C-3.5,-1.3,-2.1,0.6,-0.6,2.4C0.8,4.3,2.2,6.1,3.6,8C5.1,9.8,6.5,11.7,8,13.5C9.5,15.3,11.1,17.1,12.6,18.9z" stroke-linecap="round" transform="matrix(1,0,0,1,552,207)" id="139" ed:tosuperid="138" fill="#58d5d5"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,39.9C-4.7,39.9,11.9,-39.9,-13.5,-39.9" transform="matrix(1,0,0,1,376,126)" stroke-width="2" id="141" ed:tosuperid="140" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,24.9C-2.7,24.9,7.1,-24.9,-13.5,-24.9" transform="matrix(1,0,0,1,376,141)" stroke-width="2" id="143" ed:tosuperid="142" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,10C0.4,10,0,-10,-13.5,-10" transform="matrix(1,0,0,1,376,156)" stroke-width="2" id="145" ed:tosuperid="144" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,-4.9C1.5,-4.9,-2.7,4.9,-13.5,4.9" transform="matrix(1,0,0,1,376,171)" stroke-width="2" id="147" ed:tosuperid="146" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,-19.8C-1.7,-19.8,4.9,19.8,-13.5,19.8" transform="matrix(1,0,0,1,376,186)" stroke-width="2" id="149" ed:tosuperid="148" fill="none"/>
    <path stroke-linejoin="round" stroke="#a98ae7" ed:parentid="123" stroke-linecap="round" d="M13.5,-32.8C-3.9,-32.8,10,32.8,-13.5,32.8" transform="matrix(1,0,0,1,355,401)" stroke-width="2" id="151" ed:tosuperid="150" fill="none"/>
    <path stroke-linejoin="round" stroke="#58d5d5" ed:parentid="138" stroke-linecap="round" d="M13.5,-34.8C-4.2,-34.8,10.6,34.8,-13.5,34.8" transform="matrix(1,0,0,1,376,201)" stroke-width="2" id="155" ed:tosuperid="154" fill="none"/>
    <g ed:topictype="mainidea" ed:layout="map" transform="matrix(1,0,0,1,553,221)" ed:width="123.872" ed:height="54.6" id="101">
        <path stroke-linejoin="round" stroke="#ffffff" d="M27.3,0L96.6,0C111.6,0,123.9,12.2,123.9,27.3C123.9,42.4,111.6,54.6,96.6,54.6L27.3,54.6C12.2,54.6,0,42.4,0,27.3C0,12.2,12.2,0,27.3,0z" stroke-width="4" fill="#ffffff"/>
        <text class="st36">
            <tspan y="32.7" x="24" style="white-space:pre">MyBatis</tspan>
        </text>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,89)" ed:width="125.8" ed:height="33.55" id="112">
        <path stroke-linejoin="round" stroke="#5fb7f1" d="M0,33.5L125.8,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">#{}和${}</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>#{}在动态SQL解析后变为?，然后在JDBC的预编译中变成相应参数。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>${}在动态SQL解析后就会变成相应参数，可能会有SQL注入的风险。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>SQL预编译指的是数据库驱动在发送SQL语句和参数给DBMS之前对SQL进行编译，这样DBMS执行SQL时，就不需要编译了。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>预编译能够防止SQL注入&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>是因为：SQL语句在程序运行前已经进行了预编译，在程序运行时第一次操作数据库之前，SQL语句已经被数据库分析，编译和优化，对应的执行计划也会缓存下来并允许数据库&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545; background-color:#ffff00;&quot;>以参数化的形式进行查询&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>，当运行时动态地把参数传给PreprareStatement时，即使参数里有敏感字符如 or '1=1'。数据库也会将其&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545; background-color:#ffff00;&quot;>作为一个字段的属性值&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>来处理而不会作为一个SQL指令。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(93,9)" xlink:href="#note"/>
        </g>
    </g>
    <symbol id="note">
        <image height="16" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADtUlEQVRYCcVXS0gWURQ+d+Z/qJWPiEot0ohQc6GbHkSZFb0spHbRTmjVQlyEWuuokIiIVkVERLUrSMpa9A4fYFSLJIyyh1omqOXrH/+Z6Zzj3GGc/8HM309e+OfcOXPO+b577r3nv1dAkmaaZj5+Lkhi4uXTgBBi0Ish2yCoir8m/PXjL12NYlFM1U1EOBWWwSNz6sf2mTdnQf/ZCebUkNPEd19kLgV12QYIVjSCyFz+GAPswozoMpCbQBOCn55+sB/MyKi0SYsU4VzI2NtKJJqRwBkZ1E2gX2tvKIj23QO1oApC60+RA9tO3lojfTzJrMMf2Q4HBFrXSdAHnkGg6ACENp2nNVEogyiyg+nnBUdpp+YElzapSBoAxaJmxS6wsFhnE8A3Xu1yzuXI2QofShbx89bcthxLzXCuJ3tnOQkkjU6jcAeO50A2csRgaGAMdwOYBoSrrwEEsmJcAjGaBAolfytk1L5I8DWOOjoBkad1oP/qhsDKPRDafAHC267GGHrOQIxnMoUDnMyi39pAe1UP6pJK6ZUpO+knoI3A9MODPHJlQSGEt1wCEcq2SYDJJeAiLsSFRCK9BHDkk607wfj9CUFzILzjJqgrduP8X3eTqEDs2+klYKUdImMUF0xtDPSv97mvLC6fQ2Lm3TnS12AWStOTAcecU9pDlc0ghAIalvNoz2UmQTuCdgM3JTgrAQzPu0B6xEgXOKVdIAkRzgOts4lJGBP9oPfdBXNmHKthLQTL6ynMHayIH/6NQAJwiq4WH4IQykhHI0R7b5CKwUMbWwCE0oWvR0iX+hQkAafA1MSiIhBqmPtK9mqwwOm9AUc/RZ3UCHgAN4ZfcyEy9WlQqYjta8P/gg7CpBaZFakQMKN2heN9bs25DEjSBrfmPFx1hcEjz486zbjvOwPG4MvZIoM1Xy44Z1Q3uEw7g+v2wG0X/wRG37OzuqqGV7sdCTuJwNkmDjjp/RMY6eF4Sm4JS/lICi6N4kjf29CQBPLKZsPhPOtD7aC1H7f3uUx7HLwYlT8C0Ukwx79wEO1tC5hjvWCMf7eDUpHxA06OvgiYfz4D1m8G1PufsBSBDFBy1uIZshoC645RkWG914cvAgKBgiV1uHICoOSWgZJXisWm2Deok5yTwAB9oHM8nQvpNOs+FwL+iQQrTzj9PfUpFjWKbTXGor6dLyyNdH0aoEsENTpKS0dWpPiQx3Jyt2LPuaq57wXzfjGhu9t/vZrFJBZX+fxdTt1skAzfltx6n+9z5tzt+xdJwGKygJ8cdgAAAABJRU5ErkJggg==" width="16"/>
    </symbol>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,22)" ed:width="121" ed:height="33.55" id="113">
        <path stroke-linejoin="round" stroke="#ff7575" d="M0,33.5L121,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">执行流程</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>1. 创建SqlSessionFactory：SqlSessionFactory f = new SqlSessionFactoryBuilder().build(reader)&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>2. 创建SqlSession：f.openSession()&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>3. 使用动态代理获得Mapper：mapper = sqlSession.getMapper(XXX.class)&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#454545;&quot;>4. 执行Mapper接口方法：xxxMapper.select...()&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(88,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,441)" ed:width="157.8" ed:height="33.55" id="114">
        <path stroke-linejoin="round" stroke="#fa8556" d="M0,33.5L157.8,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">与Spring整合</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>首先都需要配置dataSource和sqlSessionFactoryBean&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean id=&amp;quot;dataSource&amp;quot; class=&amp;quot;org.springframework.jdbc.datasource.DriverManagerDataSource&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&#x9;&amp;lt;property name=&amp;quot;driverClassName&amp;quot; value=&amp;quot;com.mysql.jdbc.Driver&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;url&amp;quot; value=&amp;quot;jdbc:mysql://172.16.1.127:3306/twd&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;username&amp;quot; value=&amp;quot;twd&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;password&amp;quot; value=&amp;quot;123456&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean id=&amp;quot;sqlSessionFactory&amp;quot; class=&amp;quot;org.mybatis.spring.SqlSessionFactoryBean&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;dataSource&amp;quot; ref=&amp;quot;dataSource&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>然后有两种方法配置Mapper&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>1. 在xml文件中sqlSessionFactory构造Mapper。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean id=&amp;quot;studentMapper&amp;quot; class=&amp;quot;org.mybatis.spring.mapper.MapperFactoryBean&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&#x9;&amp;lt;property name=&amp;quot;mapperInterface&amp;quot; value=&amp;quot;com.twd.mapper.StudentMapper&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&#x9;&amp;lt;property &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>name=&amp;quot;sqlSessionFactory&amp;quot; ref=&amp;quot;sqlSessionFactory&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000; background-color:#ffffff;&quot;>2. 在xml文件中配置SqlSessionTemplate，然后构造Mapper&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>&amp;lt;!-- SqlSessionTemplate是一种线程安全的SqlSession，能供多个Mapper使用，可以替代DefaultSqlSession --&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean id=&amp;quot;sqlSession&amp;quot; class=&amp;quot;org.mybatis.spring.SqlSessionTemplate&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;constructor-arg index=&amp;quot;0&amp;quot; ref=&amp;quot;sqlSessionFactory&amp;quot; /&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean id=&amp;quot;studentMapper&amp;quot; class=&amp;quot;org.mybatis.spring.mapper.MapperFactoryBean&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;mapperInterface&amp;quot; value=&amp;quot;com.twd.mapper.StudentMapper&amp;quot;/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>property name=&amp;quot;sqlSessionTemplate&amp;quot; ref=&amp;quot;sqlSession&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>/&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(125,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,231)" ed:width="121" ed:height="33.55" id="115">
        <path stroke-linejoin="round" stroke="#f1a3dc" d="M0,33.5L121,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">分页方式</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>1. 数组分页&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>通过对所有查询结果进行自主分页&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>2. SQL分页&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>在SQL语句上传入limit参数&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>MyBatis接口：List&amp;lt;Student&amp;gt; queryStudentsBySql(Map&amp;lt;String,Object&amp;gt; data);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>XML文件：&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>&amp;lt;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#800000;&quot;>select &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>id&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>=&amp;quot;queryStudentsBySql&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;> parameterType&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>=&amp;quot;map&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;> resultMap&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>=&amp;quot;studentmapper&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        select * from student limit #{currIndex} , #{pageSize}&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>&amp;lt;/&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#800000;&quot;>select&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>实现：&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>public&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;> List&amp;lt;Student&amp;gt; queryStudentsBySql(&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>int&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;> currPage, &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>int&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;> pageSize) {&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        Map&amp;lt;String, Object&amp;gt; data = &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>new&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;> HashedMap();&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        data.put(&amp;quot;currIndex&amp;quot;, (currPage-1)*pageSize);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        data.put(&amp;quot;pageSize&amp;quot;, pageSize);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#0000ff;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;> studentMapper.queryStudentsBySql(data);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    }&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>}&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>3. 拦截器分页&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>通过在生成PrepareStatement前改变SQL语句，从而实现分页。实际上拦截StatementHandler的prepare方法。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>@Intercepts({@Signature(type = StatementHandler.class, method = &amp;quot;prepare&amp;quot;, args = {Connection.class, Integer.class})})&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>public class MyInterceptor implements Interceptor {&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    @Override&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    public Object intercept(Invocation invocation) throws Throwable {&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        RoutingStatementHandler handler = (RoutingStatementHandler) invocation.getTarget();&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        StatementHandler delegate = (StatementHandler) getFieldValue(handler, &amp;quot;delegate&amp;quot;);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        MappedStatement mappedStatement = (MappedStatement) getFieldValue(delegate, &amp;quot;mappedStatement&amp;quot;);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        if (mappedStatement.getId().matches(&amp;quot;.+ByPage&amp;quot;)) {&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>            BoundSql boundSql = handler.getBoundSql();&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>            String sql = (String) getFieldValue(boundSql, &amp;quot;sql&amp;quot;);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>            setFieldValue(boundSql, &amp;quot;sql&amp;quot;, sql + &amp;quot; limit 2, 2&amp;quot;);&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        }&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>        return invocation.proceed();&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    }&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    ...&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>}&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>4. RowBound分页&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>List&amp;lt;Student&amp;gt; students = session.selectList(&amp;quot;com.twd.mapper.StudentMapper.selectAll&amp;quot;, null, new RowBounds(0, 5));&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(88,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,308)" ed:width="173.8" ed:height="33.55" id="116">
        <path stroke-linejoin="round" stroke="#6cc9e5" d="M0,33.5L173.8,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">批量注册Mapper</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;bean class=&amp;quot;org.mybatis.spring.mapper.&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>MapperScannerConfigurer&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;quot;&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>    &amp;lt;property name=&amp;quot;basePackage&amp;quot; value=&amp;quot;com.twd.mapper&amp;quot; /&amp;gt;&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>&amp;lt;/bean&amp;gt;&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(141,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,155)" ed:width="121" ed:height="33.55" id="117">
        <path stroke-linejoin="round" stroke="#ffcd55" d="M0,33.5L121,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">核心对象</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>ParameterHandler&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：处理SQL的参数对象&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>ResultSetHandler&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：处理SQL的返回结果集&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>StatementHandler&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：数据库的处理对象，用于执行SQL语句&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>有三种：SimpleStatementHandler、PreparedStatementHandler和CallableStatementHandler。分别对应于JDBC的Statement、PreparedStatement和CallableStatement。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>RoutingStatementHandler则根据statementType创建不同的StatementHandler代理。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>Executor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：MyBatis的执行器，用于执行增删改查&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>有三种：SimpleExecutor，ReuseExecutor，BatchExecutor。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(88,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="115" transform="matrix(1,0,0,1,887,222)" ed:width="93.40000000000001" ed:height="23.35" id="118">
        <path stroke-linejoin="round" stroke="#f1a3dc" d="M0,23.4L93.4,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">逻辑分页</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>将所有数据读入内存中，再进行分页。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(68,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="115" transform="matrix(1,0,0,1,887,251)" ed:width="93.40000000000001" ed:height="23.35" id="119">
        <path stroke-linejoin="round" stroke="#f1a3dc" d="M0,23.4L93.4,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">物理分页</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>只向数据库读取定量数据。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(68,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="rightmap" ed:parentid="101" transform="matrix(1,0,0,1,739,374)" ed:width="105" ed:height="33.55" id="120">
        <path stroke-linejoin="round" stroke="#80cf70" d="M0,33.5L105,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">执行器</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>MyBatis有三种基本的执行器&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>1. &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>SimpleExecutor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：每执行一次update或select，就开启一个Statement对象，用完立刻关闭Statement。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>2. &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>ReuseExecutor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：执行update或select，以SQL作为key查找Statement对象，存在就使用，不存在就创建。用完后不关闭Statement对象，而是放在map中，供下一次使用。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>3. &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; color:#ff0000;&quot;>BatchExecutor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>：执行update（没有select），将所有SQL都添加到批处理中，等待统一执行（executeBatch()），它缓存了多个Statement对象。每个Statement对象都是addBatch()完毕后，等待逐一执行批处理。&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>Batch执行器不仅重用语句，还会批量更新&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>其中CachingExecutor是装饰器，给上述三个具体的Executor增加缓存功能。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(72,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:topictype="floating" ed:layout="rightmap" transform="matrix(1,0,0,1,908,81)" ed:width="112.8" ed:height="36" id="122">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M4,0L108.8,0C111.5,0,112.8,1.3,112.8,4L112.8,32C112.8,34.7,111.5,36,108.8,36L4,36C1.3,36,0,34.7,0,32L0,4C0,1.3,1.3,0,4,0z" fill="#a98ae7"/>
        <text class="st39">
            <tspan y="23.4" x="18" style="white-space:pre">SQL注入</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>SQL注入是一种注入攻击，可以执行恶意SQL语句，通过将任意SQL代码插入数据库查询，使攻击者能够控制Web应用程序后面的数据库。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(78,10)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="101" transform="matrix(1,0,0,1,369,334)" ed:width="121" ed:height="33.55" id="123">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,33.5L121,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">配置解析</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'微软雅黑'; font-size:11pt;&quot;>通过构建xml树，从根节点configuration依次往下进行配置。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(88,9)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,231,269)" ed:width="111" ed:height="21.75" id="128">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,21.8L111,21.8" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="14.7" x="8" style="white-space:pre">properties</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>1. 先将子节点内容转化为属性对象Properties，并设置为&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>defaults&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>2. 通过当前&amp;lt;properties&amp;gt;的属性url或resource加载并解析属性文件，添加到defaults中。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>3. 最后将configuration原本的属性添加进行，并设置成为configuration的最终属性变量。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(85,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,252,297)" ed:width="89.40000000000001" ed:height="21.75" id="130">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,21.8L89.4,21.8" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="14.7" x="8" style="white-space:pre">setting</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>首先调用settingsAsProperties方法&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>1. 解析setting子节点内容，并将解析结果转化为Properties对象。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>2. 为Configuration创建元信息对象&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>3. 通过MetaClass检测Configuration中是否存在某个属性的setter方法；不存在则抛出异常。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>4. 若通过MetaClass的检测，则返回Properties对象，方法逻辑结束。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>实际原理是&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>通过反射判断Configuration.class中是否有对应属性的set方法&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;/body>">
            <use transform="translate(64,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,238,325)" ed:width="103.8" ed:height="21.75" id="132">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,21.8L103.8,21.8" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="14.7" x="8" style="white-space:pre">typeAlias</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>其实就是构建一个别名到class对象的映射，存在typeAliasRegistry中。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(78,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,259,354)" ed:width="82.2" ed:height="21.75" id="134">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,21.8L82.2,21.8" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="14.7" x="8" style="white-space:pre">plugin</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>会对插件进行实例化，存储在Configuration中。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(56,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,223,382)" ed:width="118.2" ed:height="21.75" id="136">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,21.8L118.2,21.8" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="14.7" x="8" style="white-space:pre">typeHandler</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>类型处理器，解决jdbcType和JavaType之间的转换关系，可以使用自动扫描（需要在类型转换器上使用@MappedType和@MappedJdbcType分别指明Java类型和Jdbc类型）和xml配置。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(92,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="101" transform="matrix(1,0,0,1,390,133)" ed:width="100" ed:height="33.55" id="138">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,33.5L100,33.5" stroke-width="2" fill="none"/>
        <text class="st37">
            <tspan y="22.3" x="17" style="white-space:pre">执行过程</tspan>
        </text>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,199,63)" ed:width="163.8" ed:height="23.35" id="140">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L163.8,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">为mapper生成接口类</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>Mapper的实际代理MapperProxyFactory已经存在，但是代理对象都是即时生成的。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>MapperMethod也是懒加载的，但是生成后就会进行缓存。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(138,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,22,93)" ed:width="340.6" ed:height="23.35" id="142">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L340.6,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">根据配置信息生成SQL，并将运行时参数设置到SQL</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>MyBatis会将映射文件中的SQL解析成一组SQL片段。如果某个片段中也包含SQL相关标签，那么MyBatis会对该片段进行再次分片。最终，一个SQL配置将会被解析成一个SQL片段树。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>根据SQL配置中是否&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt; background-color:#ffff00;&quot;>包含${}，&amp;lt;if&amp;gt;和&amp;lt;where&amp;gt;&lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>结点，会选择是否使用DynamicSqlSource去存储SQL片段；否则使用RawSqlSource存储。#{}则被设置为？&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(315,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,236,123)" ed:width="126.8" ed:height="23.35" id="144">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L126.8,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">一二级缓存的实现</tspan>
        </text>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,290,153)" ed:width="72.40000000000001" ed:height="23.35" id="146">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L72.4,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">插件机制</tspan>
        </text>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,215,183)" ed:width="147.8" ed:height="23.35" id="148">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L147.8,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">数据库连接和获取</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>分为池化的和非池化的。这里主要讲下PooledDataSource。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas'; font-size:11pt;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>PooledDataSource会维护两个池，一个是空闲池，一个是活跃池。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>当需要获得连接时，会经历以下步骤：&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>1. 查看空闲池是否有连接，有的话直接用。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>2. 查看活跃池的连接数是否达到上限，没有的话创建一个。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>3. 活跃池中最老的连接是否超时，超时的话回滚当前事务，复用该老连接创建一个新连接。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>4. 若未超时，继续等待。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(122,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="123" transform="matrix(1,0,0,1,232,410)" ed:width="109.4" ed:height="23.35" id="150">
        <path stroke-linejoin="round" stroke="#a98ae7" d="M0,23.4L109.4,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">mapper解析</tspan>
        </text>
        <g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; font-size:11pt;&quot;>对于mapper的xml文件或是注解类进行解析，然后根据命令空间绑定mapper接口。&lt;/span>&lt;/p>&lt;/body>">
            <use transform="translate(84,3)" xlink:href="#note"/>
        </g>
    </g>
    <g ed:layout="leftmap" ed:parentid="138" transform="matrix(1,0,0,1,195,212)" ed:width="167.6" ed:height="23.35" id="154">
        <path stroke-linejoin="round" stroke="#58d5d5" d="M0,23.4L167.6,23.4" stroke-width="2" fill="none"/>
        <text class="st38">
            <tspan y="16.3" x="8" style="white-space:pre">查询结果处理和延迟加载</tspan>
        </text>
    </g>
    <symbol id="plus">
        <path d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6z" fill="url(#lg11)"/>
        <path stroke="#46a000" d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6zM3,6L9,6M6,3L6,9" stroke-width="0.7" fill="none"/>
    </symbol>
    <symbol id="minus">
        <path d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6z" fill="url(#lg11)"/>
        <path stroke="#46a000" d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6zM3,6L9,6" stroke-width="0.7" fill="none"/>
    </symbol>
    <g ed:togtopicid="101" transform="translate(677,242)">
        <use xlink:href="#minus"/>
    </g>
    <g ed:togtopicid="115" transform="translate(861,242)">
        <use xlink:href="#minus"/>
    </g>
    <g ed:togtopicid="123" transform="translate(356,345)">
        <use xlink:href="#minus"/>
    </g>
    <g ed:togtopicid="138" transform="translate(377,143)">
        <use xlink:href="#minus"/>
    </g>
</svg>
</div>
        <div id="copyright">Created With  <a href="https://www.edrawsoft.com/" target="_blank" title="edrawsoft">MindMaster</a></div>
      </div>
    </div>
    <script>eval(atob('dmFyIG11YT13aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsNCnZhciB1YT0obXVhLmluZGV4T2YoJ3J2OjExJykrbXVhLmluZGV4T2YoJ01TSUUnKSk+PTA7DQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ZnLWNvbnRhaW5lcicpLm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KfQ0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N2Zy1jb250YWluZXInKS5vbm1vdXNlZG93biA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgIGlmKGV2ZW50LndoaWNoID09Myl7DQogICAgICAgIHRoaXMuc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInOw0KICAgICAgICB0aGlzLm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24gKGV2KSB7DQogICAgICAgICAgICB0aGlzLnNjcm9sbEJ5KC0oZXYubW92ZW1lbnRYKSwgMCk7DQogICAgICAgICAgICB3aW5kb3cuc2Nyb2xsQnkoMCwtKGV2Lm1vdmVtZW50WSkpDQogICAgICAgIH0NCiAgICAgICAgdGhpcy5vbm1vdXNldXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLnN0eWxlLmN1cnNvciA9ICBudWxsOw0KICAgICAgICAgICAgdGhpcy5vbm1vdXNldXAgPSBudWxsOw0KICAgICAgICAgICAgdGhpcy5vbm1vdXNlbW92ZSA9IG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQpOdW1iZXIucHJvdG90eXBlLnRvc3VpdHN2Zz1mdW5jdGlvbiAoKSB7DQogICAgdmFyIG51bT10aGlzLnZhbHVlT2YoKTsNCiAgICBpZihudW0lMT09PTApew0KICAgICAgICByZXR1cm4gbnVtKzAuNQ0KICAgIH1lbHNlIHJldHVybiBudW07DQp9Ow0KTnVtYmVyLnByb3RvdHlwZS5wbHVzej1mdW5jdGlvbigpIHsNCiAgICB2YXIgbnVtPXRoaXMudmFsdWVPZigpOw0KICAgIHJldHVybiBudW08MTA/JzAnK251bTpudW07DQp9Ow0KZnVuY3Rpb24gcGFyc2VEYXRlKG51bSkgew0KICAgIHZhciBkYXRlID0gbmV3IERhdGUobnVtKTsNCiAgICB2YXIgWSA9IGRhdGUuZ2V0RnVsbFllYXIoKSArICctJzsNCiAgICB2YXIgTSA9IChkYXRlLmdldE1vbnRoKCkrMSkucGx1c3ooKSArICctJzsNCiAgICB2YXIgRCA9IGRhdGUuZ2V0RGF0ZSgpLnBsdXN6KCkgKyAnICc7DQogICAgdmFyIGggPSBkYXRlLmdldEhvdXJzKCkucGx1c3ooKSArICc6JzsNCiAgICB2YXIgbW0gPSBkYXRlLmdldE1pbnV0ZXMoKS5wbHVzeigpICsgJzonOw0KICAgIHZhciBzID0gZGF0ZS5nZXRTZWNvbmRzKCkucGx1c3ooKTsNCiAgICByZXR1cm4gWStNK0QraCttbStzOw0KfQ0KLy8tLXByZWRlZmluZWQNCi8vY29tbWVudC0tDQp2YXIgY29tbWVudHM9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZz5nW2VkXFw6Y29tbWVudF0nKTsNCmZ1bmN0aW9uIGdldGN3aChwb3B1cCkgew0KICAgIGRvY3VtZW50LmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N2ZycpWzBdLmFwcGVuZENoaWxkKHBvcHVwKTsNCiAgICB2YXIgdz1wb3B1cC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDsNCiAgICB2YXIgaD1wb3B1cC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7DQogICAgcmV0dXJuIFt3LGhdDQp9DQpmb3IodmFyIGk9MDtpPGNvbW1lbnRzLmxlbmd0aDtpKyspew0KICAgIHZhciBwb3B1cD1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywnZycpOw0KICAgIHZhciBwb3B1cFI9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdyZWN0Jyk7DQogICAgdmFyIGhvdmVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdyZWN0Jyk7DQogICAgdmFyIG9saW5lPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdyZWN0Jyk7DQogICAgaG92ZXIuc2V0QXR0cmlidXRlKCdmaWxsJywnI2NkY2RmZicpOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgneCcsJzAnKTsNCiAgICBob3Zlci5zZXRBdHRyaWJ1dGUoJ3knLCcwJyk7DQogICAgaG92ZXIuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCcxNicpOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCcxNicpOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnZmlsbC1vcGFjaXR5JywnMC42Jyk7DQogICAgaG92ZXIuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLGNvbW1lbnRzW2ldLnF1ZXJ5U2VsZWN0b3IoJ3VzZScpLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJykpOw0KICAgIGhvdmVyLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgIGNvbW1lbnRzW2ldLmFwcGVuZENoaWxkKGhvdmVyKTsNCiAgICB2YXIgYT1KU09OLnBhcnNlKGNvbW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnZWQ6Y29tbWVudCcpKTsNCiAgICB2YXIgaGVpZ2h0PTA7DQogICAgdmFyIGNhcnI9W107DQogICAgZm9yKHZhciBqPTA7ajxhLmxlbmd0aDtqKyspew0KICAgICAgICB2YXIgc3RhbXA9TnVtYmVyKGFbal0uRGF0ZSkqMTAwMDsNCiAgICAgICAgdmFyIHRpbWU9cGFyc2VEYXRlKHN0YW1wKTsNCiAgICAgICAgdmFyIG5hbWU9YVtqXS5OYW1lOw0KICAgICAgICB2YXIgbWVzc2FnZT1hW2pdLk1lc3NhZ2U7DQogICAgICAgIHZhciBtZXNzYWdlQXJyPW1lc3NhZ2Uuc3BsaXQoL1xuLyk7DQogICAgICAgIHZhciBvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdnJyk7DQogICAgICAgIHZhciBuPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIHZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIHZhciBtPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIG4uc2V0QXR0cmlidXRlKCd4Jyw1KTsNCiAgICAgICAgbi5zZXRBdHRyaWJ1dGUoJ3knLDEyKTsNCiAgICAgICAgbi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCcjMDA2ZWZmJyk7DQogICAgICAgIG4udGV4dENvbnRlbnQ9bmFtZSsnOiAnOw0KICAgICAgICBuLnNldEF0dHJpYnV0ZSgnZm9udC1zaXplJywnMTInKTsNCiAgICAgICAgdC5zZXRBdHRyaWJ1dGUoJ3gnLDIwMCk7DQogICAgICAgIHQuc2V0QXR0cmlidXRlKCd5JywxMik7DQogICAgICAgIHQuc2V0QXR0cmlidXRlKCdmaWxsJywnIzk2OTY5NicpOw0KICAgICAgICB0LnRleHRDb250ZW50PXRpbWU7DQogICAgICAgIHQuc2V0QXR0cmlidXRlKCdmb250LXNpemUnLCcxMCcpOw0KICAgICAgICBtLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywndHJhbnNsYXRlKDIwLDI3KScpOw0KICAgICAgICBtLnNldEF0dHJpYnV0ZSgnZm9udC1zaXplJywnMTInKTsNCiAgICAgICAgZm9yKHZhciBrPTA7azxtZXNzYWdlQXJyLmxlbmd0aDtrKyspew0KICAgICAgICAgICAgdmFyIHRzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0c3BhbicpOw0KICAgICAgICAgICAgdHMuc2V0QXR0cmlidXRlKCd4JywnMCcpOw0KICAgICAgICAgICAgdHMuc2V0QXR0cmlidXRlKCd5JyxrKjE2KTsNCiAgICAgICAgICAgIHRzLnRleHRDb250ZW50PW1lc3NhZ2VBcnJba107DQogICAgICAgICAgICBtLmFwcGVuZENoaWxkKHRzKTsNCiAgICAgICAgfQ0KICAgICAgICBvLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywndHJhbnNsYXRlKDAsJytoZWlnaHQrJyknKTsNCiAgICAgICAgby5hcHBlbmRDaGlsZChuKTsNCiAgICAgICAgby5hcHBlbmRDaGlsZCh0KTsNCiAgICAgICAgby5hcHBlbmRDaGlsZChtKTsNCiAgICAgICAgY2Fyci5wdXNoKG8pOw0KICAgICAgICBwb3B1cC5hcHBlbmRDaGlsZChvKTsNCiAgICAgICAgaGVpZ2h0PShtZXNzYWdlQXJyLmxlbmd0aCsxKSoxNitoZWlnaHQ7DQogICAgfQ0KICAgIHZhciB3YXJyPWdldGN3aChwb3B1cCk7DQogICAgb2xpbmUuc2V0QXR0cmlidXRlKCd4JywnMCcpOw0KICAgIG9saW5lLnNldEF0dHJpYnV0ZSgneScsJzAnKTsNCiAgICB2YXIgb3c9d2FyclswXSsxMC41Ow0KICAgIHZhciBvaD13YXJyWzFdKzM7DQogICAgb2xpbmUuc2V0QXR0cmlidXRlKCd3aWR0aCcsb3cpOw0KICAgIG9saW5lLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JyxvaCk7DQogICAgb2xpbmUuc2V0QXR0cmlidXRlKCdmaWxsJywnd2hpdGUnKTsNCiAgICBvbGluZS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsJyM2NTY1NjUnKTsNCiAgICBwb3B1cC5hcHBlbmRDaGlsZChvbGluZSk7DQogICAgdmFyIGw9Y2Fyci5sZW5ndGg7DQogICAgd2hpbGUobC0tKXsNCiAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQoY2FycltsXSk7DQogICAgfQ0KICAgIHBvcHVwLm9ubW91c2VvdmVyPWZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5PSdibG9jayc7DQogICAgfTsNCiAgICBwb3B1cC5vbm1vdXNlb3V0PWZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIH07DQogICAgdmFyIGNzPWNvbW1lbnRzW2ldLnF1ZXJ5U2VsZWN0b3IoJ3VzZScpLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJykubWF0Y2goL1woKFxTKnxcUypcc1xTKilcKS8pWzFdLnNwbGl0KC8gfCwvKTsNCiAgICB2YXIgcHM9Y29tbWVudHNbaV0ucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScpOw0KICAgIGlmKHBzLnN1YnN0cigwLDIpID09ICd0cicpew0KICAgICAgICB2YXIgcHBzID0gcHMubWF0Y2goL1woKFxTKnxcUypcc1xTKilcKS8pWzFdLnNwbGl0KC8gfCwvKTsNCiAgICAgICAgdmFyIHg9cGFyc2VGbG9hdChjc1swXSkrcGFyc2VGbG9hdChwcHNbMF0pOw0KICAgICAgICB2YXIgeT1wYXJzZUZsb2F0KHBwc1sxXSk7DQogICAgICAgIHg9eC50b3N1aXRzdmcoKTsNCiAgICAgICAgeT15LnRvc3VpdHN2ZygpOw0KICAgICAgICB2YXIgdHJzdHIgPSAndHJhbnNsYXRlKCcreCsnLCcreSsnKSc7DQogICAgfQ0KICAgIGVsc2UgaWYocHMuc3Vic3RyKDAsMikgPT0gJ21hJyl7DQogICAgICAgIHZhciBwcHMgPSBwcy5tYXRjaCgvKFwtP1xkKyhcLlxkKyk/KVtcLCBdKFwtP1xkKyhcLlxkKyk/KVtcLCBdKFwtP1xkKyhcLlxkKyk/KVtcLCBdKFwtP1xkKyhcLlxkKyk/KVtcLCBdKFwtP1xkKyhcLlxkKyk/KVtcLCBdKFwtP1xkKyhcLlxkKyk/KVwpJC8pOw0KICAgICAgICB2YXIgbWFBcnIgPSBbcGFyc2VGbG9hdChwcHNbMV0pLHBhcnNlRmxvYXQocHBzWzNdKSxwYXJzZUZsb2F0KHBwc1s1XSkscGFyc2VGbG9hdChwcHNbN10pLHBhcnNlRmxvYXQocHBzWzldKSxwYXJzZUZsb2F0KHBwc1sxMV0pXTsNCiAgICAgICAgaWYobWFBcnJbMV0gPT0gMCl7DQogICAgICAgICAgICB2YXIgeCA9IHBhcnNlRmxvYXQoY3NbMF0pOw0KICAgICAgICAgICAgdmFyIHk9IHBhcnNlRmxvYXQoY3NbMV0pKzE2Ow0KICAgICAgICAgICAgdmFyIHgxID0geCAqIG1hQXJyWzBdICsgeSAqIG1hQXJyWzJdICsgbWFBcnJbNF07DQogICAgICAgICAgICB2YXIgeTEgPSB4ICogbWFBcnJbMV0gKyB5ICogbWFBcnJbM10gKyBtYUFycls1XTsNCiAgICAgICAgICAgIHgxPXgxLnRvc3VpdHN2ZygpOw0KICAgICAgICAgICAgeTE9eTEudG9zdWl0c3ZnKCk7DQogICAgICAgICAgICB2YXIgdHJzdHIgPSAgJ3RyYW5zbGF0ZSgnK3gxKycsJyt5MSsnKSc7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgdmFyIHggPSBwYXJzZUZsb2F0KGNzWzBdKSsxNjsNCiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VGbG9hdChjc1sxXSkrMTY7DQogICAgICAgICAgICB2YXIgeDEgPSB4ICogbWFBcnJbMF0gKyB5ICogbWFBcnJbMl0gKyBtYUFycls0XTsNCiAgICAgICAgICAgIHZhciB5MSA9IHggKiBtYUFyclsxXSArIHkgKiBtYUFyclszXSArIG1hQXJyWzVdOw0KICAgICAgICAgICAgeCA9IHBhcnNlRmxvYXQoY3NbMF0pKzE2Ow0KICAgICAgICAgICAgeSA9IHBhcnNlRmxvYXQoY3NbMV0pOw0KICAgICAgICAgICAgdmFyIHgyID0geCAqIG1hQXJyWzBdICsgeSAqIG1hQXJyWzJdICsgbWFBcnJbNF07DQogICAgICAgICAgICB2YXIgeTIgPSB4ICogbWFBcnJbMV0gKyB5ICogbWFBcnJbM10gKyBtYUFycls1XTsNCiAgICAgICAgICAgIHZhciBmeCA9IHgxPHgyP3gxLnRvc3VpdHN2ZygpOiB4Mi50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgIHZhciBmeSA9IHkxPnkyP3kxLnRvc3VpdHN2ZygpOiB5Mi50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgIHZhciBvZmZ5ID0gTWF0aC5hYnMoeTEteTIpOw0KICAgICAgICAgICAgdmFyIHRyc3RyID0gICd0cmFuc2xhdGUoJytmeCsnLCcrZnkrJyknOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JyxvZmZ5LnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCcxNicpOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgneScsKC1vZmZ5KS50b1N0cmluZygpKTsNCiAgICAgICAgICAgIHBvcHVwUi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCd0cmFuc3BhcmVudCcpOw0KICAgICAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQocG9wdXBSKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwb3B1cC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsdHJzdHIpOw0KICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgnY29tbWVudCcsJycpOw0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgnZWQ6Y29tbWVudGlkJyxjb21tZW50c1tpXS5wYXJlbnROb2RlLmlkKTsNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3ZnLWNvbnRhaW5lciA+IHN2ZycpLmFwcGVuZENoaWxkKHBvcHVwKTsNCiAgICBjb21tZW50c1tpXS5vbm1vdXNlb3Zlcj1mdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBjb21tZW50aWQ9dGhpcy5wYXJlbnROb2RlLmlkOw0KICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ3JlY3QnKS5zdHlsZS5kaXNwbGF5PSdibG9jayc7DQogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImdbZWRcXDpjb21tZW50aWQ9JyIrY29tbWVudGlkKyInXVtjb21tZW50XSIpLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICB9Ow0KICAgIGNvbW1lbnRzW2ldLm9ubW91c2VvdXQ9ZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgY29tbWVudGlkPXRoaXMucGFyZW50Tm9kZS5pZDsNCi8vICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7DQogICAgICAgIHRoaXMucXVlcnlTZWxlY3RvcigncmVjdCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJnW2VkXFw6Y29tbWVudGlkPSciK2NvbW1lbnRpZCsiJ11bY29tbWVudF0iKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICB9DQp9DQovLy0tY29tbWVudA0KLy9ub3RlLS0NCmlmKCF1YSl7DQogICAgdmFyIG5vdGVzPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2c+Z1tlZFxcOm5vdGVdJyk7DQogICAgZnVuY3Rpb24gZ2V0d2gocyxwKSB7DQogICAgICAgIHZhciBtYWlucD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICAgICAgbWFpbnAuc3R5bGUuY3NzVGV4dD1zOw0KICAgICAgICBtYWlucC5zdHlsZS5kaXNwbGF5PSdpbmxpbmUtYmxvY2snOw0KCQltYWlucC5zdHlsZS5tYXhXaWR0aCA9ICc0MDBweCc7DQoJCW1haW5wLnN0eWxlLndvcmRCcmVhayA9ICdicmVhay1hbGwnOw0KICAgICAgICBtYWlucC5pbm5lckhUTUw9cDsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtYWlucCk7DQogICAgICAgIHZhciB3PW1haW5wLmNsaWVudFdpZHRoOw0KICAgICAgICB2YXIgaD1tYWlucC5jbGllbnRIZWlnaHQ7DQogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobWFpbnApOw0KICAgICAgICByZXR1cm4gW3csaF0NCiAgICB9DQogICAgZm9yKHZhciBpPTA7aTxub3Rlcy5sZW5ndGg7aSsrKXsNCiAgICAgICAgdmFyIGE9bm90ZXNbaV0uZ2V0QXR0cmlidXRlKCdlZDpub3RlJyk7DQoJCXZhciBub3RlTG9jayA9IG5vdGVzW2ldLmdldEF0dHJpYnV0ZSgnZWQ6bm90ZWxvY2snKTsNCiAgICAgICAgaWYobm90ZUxvY2sgPT0gJ3RydWUnKXsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBtYWlucD1hLm1hdGNoKC88Ym9keVtePl0qPiguKik8XC9ib2R5Pi8pWzFdOw0KICAgICAgICB2YXIgbWFpbnM9YS5tYXRjaCgvc3R5bGU9IiguKj8pIi8pWzFdOw0KICAgICAgICB2YXIgb3V0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdnJyk7DQogICAgICAgIHZhciBvbGluZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywncmVjdCcpOw0KICAgICAgICB2YXIgcG9wdXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsJ2ZvcmVpZ25PYmplY3QnKTsNCiAgICAgICAgdmFyIHBvcHVwUj0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsJ3JlY3QnKTsNCiAgICAgICAgdmFyIGhvdmVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdyZWN0Jyk7DQogICAgICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnZmlsbCcsJyNjZGNkZmYnKTsNCiAgICAgICAgaG92ZXIuc2V0QXR0cmlidXRlKCd4JywnMCcpOw0KICAgICAgICBob3Zlci5zZXRBdHRyaWJ1dGUoJ3knLCcwJyk7DQogICAgICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywnMTYnKTsNCiAgICAgICAgaG92ZXIuc2V0QXR0cmlidXRlKCd3aWR0aCcsJzE2Jyk7DQogICAgICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnZmlsbC1vcGFjaXR5JywnMC42Jyk7DQogICAgICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyxub3Rlc1tpXS5xdWVyeVNlbGVjdG9yKCd1c2UnKS5nZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScpKTsNCiAgICAgICAgaG92ZXIuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgICAgIG5vdGVzW2ldLmFwcGVuZENoaWxkKGhvdmVyKTsNCiAgICAgICAgcG9wdXAuc3R5bGUuY3NzVGV4dD1tYWluczsNCiAgICAgICAgcG9wdXAuaW5uZXJIVE1MPW1haW5wOw0KICAgICAgICB2YXIgd2g9Z2V0d2gobWFpbnMsbWFpbnApOw0KICAgICAgICBwb3B1cC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx3aFswXSk7DQogICAgICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgnaGVpZ2h0Jyx3aFsxXSk7DQogICAgICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywndHJhbnNsYXRlKDgsNCknKTsNCgkJcG9wdXAuc3R5bGUud29yZEJyZWFrID0gJ2JyZWFrLWFsbCc7DQogICAgICAgIHBvcHVwLnN0eWxlLnRleHRBbGlnbj0nbGVmdCc7DQogICAgICAgIG9saW5lLnNldEF0dHJpYnV0ZSgneCcsJzAnKTsNCiAgICAgICAgb2xpbmUuc2V0QXR0cmlidXRlKCd5JywnMCcpOw0KICAgICAgICBvbGluZS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyx3aFswXSsxNik7DQogICAgICAgIG9saW5lLnNldEF0dHJpYnV0ZSgnaGVpZ2h0Jyx3aFsxXSs4KTsNCiAgICAgICAgb2xpbmUuc2V0QXR0cmlidXRlKCdzdHJva2UnLCcjYTI3YTAwJyk7DQogICAgICAgIG9saW5lLnNldEF0dHJpYnV0ZSgnZmlsbCcsJyNmZmU3OWQnKTsNCiAgICAgICAgb3V0LmFwcGVuZENoaWxkKG9saW5lKTsNCiAgICAgICAgb3V0LmFwcGVuZENoaWxkKHBvcHVwKTsNCiAgICAgICAgb3V0LnNldEF0dHJpYnV0ZSgnbm90ZScsJycpOw0KICAgICAgICBvdXQuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgICAgIG91dC5zZXRBdHRyaWJ1dGUoJ2VkOm5vdGVpZCcsbm90ZXNbaV0ucGFyZW50Tm9kZS5pZCk7DQogICAgICAgIG91dC5vbm1vdXNlb3Zlcj1mdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICAgICAgfTsNCiAgICAgICAgb3V0Lm9ubW91c2VvdXQ9ZnVuY3Rpb24gKCkgew0KLy8gICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24gPyB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlUmFuZ2Uod2luZG93LmdldFNlbGVjdGlvbigpLnJlKTpkb2N1bWVudC5zZWxlY3Rpb24uZW1wdHkoKTsNCg0KICAgICAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICAgICAgfTsNCiAgICAgICAgdmFyIGNzPW5vdGVzW2ldLnF1ZXJ5U2VsZWN0b3IoJ3VzZScpLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJykubWF0Y2goL1woKFxTKnxcUypcc1xTKilcKS8pWzFdLnNwbGl0KC8gfCwvKTsNCiAgICAgICAgdmFyIHBzPW5vdGVzW2ldLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nKTsNCiAgICAgICAgaWYocHMuc3Vic3RyKDAsMikgPT0gJ3RyJyl7DQogICAgICAgICAgICB2YXIgcHBzID0gcHMubWF0Y2goL1woKFxTKnxcUypcc1xTKilcKS8pWzFdLnNwbGl0KC8gfCwvKTsNCiAgICAgICAgICAgIHZhciB4PXBhcnNlRmxvYXQoY3NbMF0pK3BhcnNlRmxvYXQocHBzWzBdKTsNCiAgICAgICAgICAgIHZhciB5PXBhcnNlRmxvYXQocHBzWzFdKTsNCiAgICAgICAgICAgIHg9eC50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgIHk9eS50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgIHZhciB0cnN0ciA9ICd0cmFuc2xhdGUoJyt4KycsJyt5KycpJzsNCiAgICAgICAgfWVsc2UgaWYocHMuc3Vic3RyKDAsMikgPT0gJ21hJyl7DQogICAgICAgICAgICB2YXIgcHBzID0gcHMubWF0Y2goLyhcLT9cZCsoXC5cZCspPylbXCwgXShcLT9cZCsoXC5cZCspPylbXCwgXShcLT9cZCsoXC5cZCspPylbXCwgXShcLT9cZCsoXC5cZCspPylbXCwgXShcLT9cZCsoXC5cZCspPylbXCwgXShcLT9cZCsoXC5cZCspPylcKSQvKTsNCiAgICAgICAgICAgIHZhciBtYUFyciA9IFtwYXJzZUZsb2F0KHBwc1sxXSkscGFyc2VGbG9hdChwcHNbM10pLHBhcnNlRmxvYXQocHBzWzVdKSxwYXJzZUZsb2F0KHBwc1s3XSkscGFyc2VGbG9hdChwcHNbOV0pLHBhcnNlRmxvYXQocHBzWzExXSldOw0KICAgICAgICAgICAgaWYobWFBcnJbMV0gPT0gMCl7DQogICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUZsb2F0KGNzWzBdKTsNCiAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlRmxvYXQoY3NbMV0pKzE2Ow0KICAgICAgICAgICAgICAgIHZhciB4MSA9IHggKiBtYUFyclswXSArIHkgKiBtYUFyclsyXSArIG1hQXJyWzRdOw0KICAgICAgICAgICAgICAgIHZhciB5MSA9IHggKiBtYUFyclsxXSArIHkgKiBtYUFyclszXSArIG1hQXJyWzVdOw0KICAgICAgICAgICAgICAgIHgxPXgxLnRvc3VpdHN2ZygpOw0KICAgICAgICAgICAgICAgIHkxPXkxLnRvc3VpdHN2ZygpOw0KICAgICAgICAgICAgICAgIHZhciB0cnN0ciA9ICAndHJhbnNsYXRlKCcreDErJywnK3kxKycpJzsNCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VGbG9hdChjc1swXSkrMTY7DQogICAgICAgICAgICAgICAgdmFyIHkgPSBwYXJzZUZsb2F0KGNzWzFdKSsxNjsNCiAgICAgICAgICAgICAgICB2YXIgeDEgPSB4ICogbWFBcnJbMF0gKyB5ICogbWFBcnJbMl0gKyBtYUFycls0XTsNCiAgICAgICAgICAgICAgICB2YXIgeTEgPSB4ICogbWFBcnJbMV0gKyB5ICogbWFBcnJbM10gKyBtYUFycls1XTsNCiAgICAgICAgICAgICAgICB4ID0gcGFyc2VGbG9hdChjc1swXSkrMTY7DQogICAgICAgICAgICAgICAgeSA9IHBhcnNlRmxvYXQoY3NbMV0pOw0KICAgICAgICAgICAgICAgIHZhciB4MiA9IHggKiBtYUFyclswXSArIHkgKiBtYUFyclsyXSArIG1hQXJyWzRdOw0KICAgICAgICAgICAgICAgIHZhciB5MiA9IHggKiBtYUFyclsxXSArIHkgKiBtYUFyclszXSArIG1hQXJyWzVdOw0KICAgICAgICAgICAgICAgIHZhciBmeCA9IHgxPHgyP3gxLnRvc3VpdHN2ZygpOiB4Mi50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgICAgICB2YXIgZnkgPSB5MT55Mj95MS50b3N1aXRzdmcoKTogeTIudG9zdWl0c3ZnKCk7DQoJCQkJdmFyIG9mZnkgPSBNYXRoLmFicyh5MS15Mik7CQkJCQkJCQkJCSAgDQogICAgICAgICAgICAgICAgdmFyIHRyc3RyID0gICd0cmFuc2xhdGUoJytmeCsnLCcrZnkrJyknOw0KICAgICAgICAgICAgICAgIHBvcHVwUi5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsb2ZmeS50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBwb3B1cFIuc2V0QXR0cmlidXRlKCd3aWR0aCcsJzE2Jyk7DQogICAgICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgneScsKC1vZmZ5KS50b1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICBwb3B1cFIuc2V0QXR0cmlidXRlKCdmaWxsJywndHJhbnNwYXJlbnQnKTsNCiAgICAgICAgICAgICAgICBwb3B1cC5hcHBlbmRDaGlsZChwb3B1cFIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG91dC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsdHJzdHIpOw0KICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3ZnLWNvbnRhaW5lciA+IHN2ZycpLmFwcGVuZENoaWxkKG91dCk7DQogICAgICAgIG5vdGVzW2ldLm9ubW91c2VvdmVyPWZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBub3RlaWQ9dGhpcy5wYXJlbnROb2RlLmlkOw0KICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCdyZWN0Jykuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZ1tlZFxcOm5vdGVpZD0nIitub3RlaWQrIiddW25vdGVdIikuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgICB9Ow0KICAgICAgICBub3Rlc1tpXS5vbm1vdXNlb3V0PWZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBub3RlaWQ9dGhpcy5wYXJlbnROb2RlLmlkOw0KLy8gICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTsNCiAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvcigncmVjdCcpLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZ1tlZFxcOm5vdGVpZD0nIitub3RlaWQrIiddW25vdGVdIikuc3R5bGUuZGlzcGxheT0nbm9uZSc7DQogICAgICAgIH0NCiAgICB9DQp9ZWxzZXsNCiAgICBjb25zb2xlLmxvZygn5oqx5q2J77yMSUXmtY/op4jlmajkuI3mlK/mjIFub3Rl6Kej5p6Q77yM6K+35L2/55So5YW25LuW5YaF5qC45rWP6KeI5Zmo44CC6LCi6LCi77yBJykNCn0NCi8vLS1ub3RlDQovL2h5cGVybGluay0tDQp2YXIgbGlua3M9ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZz5nW2VkXFw6aHlwZXJsaW5rXScpOw0KZnVuY3Rpb24gZ2V0bWF4bGVuKGFycixicnIpIHsNCiAgICB2YXIgbD0wOw0KICAgIHZhciBsbD0wOw0KICAgIGZvcih2YXIgaj0wO2o8YXJyLmxlbmd0aDtqKyspew0KICAgICAgICB2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywndGV4dCcpOw0KICAgICAgICBpZighaXNOYU4obGlua2FycltqXSkpew0KICAgICAgICAgICAgZS50ZXh0Q29udGVudD0nUGFnZS0nK2FycltqXTsNCiAgICAgICAgfWVsc2V7DQogICAgICAgICAgICBlLnRleHRDb250ZW50PWFycltqXTsNCiAgICAgICAgfQ0KICAgICAgICBlLnN0eWxlLmZvbnRTaXplPScxMnB4JzsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3ZnJylbMF0uYXBwZW5kQ2hpbGQoZSk7DQogICAgICAgIHZhciBldz1lLmdldEJCb3goKS53aWR0aDsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3ZnJylbMF0ucmVtb3ZlQ2hpbGQoZSk7DQogICAgICAgIHZhciBoPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIGgudGV4dENvbnRlbnQ9YnJyW2pdOw0KICAgICAgICBoLnN0eWxlLmZvbnRTaXplPScxMnB4JzsNCiAgICAgICAgaC5zdHlsZS5mb250V2VpZ2h0PSdib2xkJzsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3ZnJylbMF0uYXBwZW5kQ2hpbGQoaCk7DQogICAgICAgIHZhciBodz1oLmdldEJCb3goKS53aWR0aDsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3ZnJylbMF0ucmVtb3ZlQ2hpbGQoaCk7DQogICAgICAgIGw9ZXc+aHc/ZXc6aHc7DQogICAgICAgIGxsPWw+bGw/bDpsbDsNCiAgICB9DQogICAgcmV0dXJuIGxsOw0KfQ0KZm9yKHZhciBpPTA7aTxsaW5rcy5sZW5ndGg7aSsrKXsNCiAgICB2YXIgcG9wdXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsJ2cnKTsNCiAgICB2YXIgcG9wdXBSPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywncmVjdCcpOw0KICAgIHZhciBob3Zlcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywncmVjdCcpOw0KICAgIHZhciBkZXNjYXJyPVtdOw0KICAgIHZhciBsaW5rYXJyPVtdOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnZmlsbCcsJyNjZGNkZmYnKTsNCiAgICBob3Zlci5zZXRBdHRyaWJ1dGUoJ3gnLCcwJyk7DQogICAgaG92ZXIuc2V0QXR0cmlidXRlKCd5JywnMCcpOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywnMTYnKTsNCiAgICBob3Zlci5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywnMTYnKTsNCiAgICBob3Zlci5zZXRBdHRyaWJ1dGUoJ2ZpbGwtb3BhY2l0eScsJzAuNicpOw0KICAgIGhvdmVyLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyxsaW5rc1tpXS5xdWVyeVNlbGVjdG9yKCd1c2UnKS5nZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScpKTsNCiAgICBob3Zlci5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICBsaW5rc1tpXS5hcHBlbmRDaGlsZChob3Zlcik7DQogICAgLy8gY29uc29sZS5sb2cobGlua3NbaV0uZ2V0QXR0cmlidXRlKCdlZDpoeXBlcmxpbmsnKSk7DQogICAgdmFyIGE9SlNPTi5wYXJzZShsaW5rc1tpXS5nZXRBdHRyaWJ1dGUoJ2VkOmh5cGVybGluaycpKTsNCiAgICB2YXIgY3M9bGlua3NbaV0ucXVlcnlTZWxlY3RvcigndXNlJykuZ2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nKS5tYXRjaCgvXCgoXFMqfFxTKlxzXFMqKVwpLylbMV0uc3BsaXQoLyB8LC8pOw0KICAgIHZhciBwcz1saW5rc1tpXS5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyk7DQogICAgaWYocHMuc3Vic3RyKDAsMikgPT0gJ3RyJyl7DQogICAgICAgIHZhciBwcHMgPSBwcy5tYXRjaCgvXCgoXFMqfFxTKlxzXFMqKVwpLylbMV0uc3BsaXQoLyB8LC8pOw0KICAgICAgICB2YXIgeD1wYXJzZUZsb2F0KGNzWzBdKStwYXJzZUZsb2F0KHBwc1swXSk7DQogICAgICAgIHZhciB5PXBhcnNlRmxvYXQocHBzWzFdKTsNCiAgICAgICAgeD14LnRvc3VpdHN2ZygpOw0KICAgICAgICB5PXkudG9zdWl0c3ZnKCk7DQogICAgICAgIHZhciB0cnN0ciA9ICd0cmFuc2xhdGUoJyt4KycsJyt5KycpJzsNCiAgICB9ZWxzZSBpZihwcy5zdWJzdHIoMCwyKSA9PSAnbWEnKXsNCiAgICAgICAgdmFyIHBwcyA9IHBzLm1hdGNoKC8oXC0/XGQrKFwuXGQrKT8pW1wsIF0oXC0/XGQrKFwuXGQrKT8pW1wsIF0oXC0/XGQrKFwuXGQrKT8pW1wsIF0oXC0/XGQrKFwuXGQrKT8pW1wsIF0oXC0/XGQrKFwuXGQrKT8pW1wsIF0oXC0/XGQrKFwuXGQrKT8pXCkkLyk7DQogICAgICAgIHZhciBtYUFyciA9IFtwYXJzZUZsb2F0KHBwc1sxXSkscGFyc2VGbG9hdChwcHNbM10pLHBhcnNlRmxvYXQocHBzWzVdKSxwYXJzZUZsb2F0KHBwc1s3XSkscGFyc2VGbG9hdChwcHNbOV0pLHBhcnNlRmxvYXQocHBzWzExXSldOw0KICAgICAgICBpZihtYUFyclsxXSA9PSAwKXsNCiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VGbG9hdChjc1swXSk7DQogICAgICAgICAgICB2YXIgeSA9IHBhcnNlRmxvYXQoY3NbMV0pKzE2Ow0KICAgICAgICAgICAgdmFyIHgxID0geCAqIG1hQXJyWzBdICsgeSAqIG1hQXJyWzJdICsgbWFBcnJbNF07DQogICAgICAgICAgICB2YXIgeTEgPSB4ICogbWFBcnJbMV0gKyB5ICogbWFBcnJbM10gKyBtYUFycls1XTsNCiAgICAgICAgICAgIHgxPXgxLnRvc3VpdHN2ZygpOw0KICAgICAgICAgICAgeTE9eTEudG9zdWl0c3ZnKCk7DQogICAgICAgICAgICB2YXIgdHJzdHIgPSAgJ3RyYW5zbGF0ZSgnK3gxKycsJyt5MSsnKSc7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgICAgdmFyIHggPSBwYXJzZUZsb2F0KGNzWzBdKSsxNjsNCiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VGbG9hdChjc1sxXSkrMTY7DQogICAgICAgICAgICB2YXIgeDEgPSB4ICogbWFBcnJbMF0gKyB5ICogbWFBcnJbMl0gKyBtYUFycls0XTsNCiAgICAgICAgICAgIHZhciB5MSA9IHggKiBtYUFyclsxXSArIHkgKiBtYUFyclszXSArIG1hQXJyWzVdOw0KICAgICAgICAgICAgeCA9IHBhcnNlRmxvYXQoY3NbMF0pKzE2Ow0KICAgICAgICAgICAgeSA9IHBhcnNlRmxvYXQoY3NbMV0pOw0KICAgICAgICAgICAgdmFyIHgyID0geCAqIG1hQXJyWzBdICsgeSAqIG1hQXJyWzJdICsgbWFBcnJbNF07DQogICAgICAgICAgICB2YXIgeTIgPSB4ICogbWFBcnJbMV0gKyB5ICogbWFBcnJbM10gKyBtYUFycls1XTsNCiAgICAgICAgICAgIHZhciBmeCA9IHgxPHgyP3gxLnRvc3VpdHN2ZygpOiB4Mi50b3N1aXRzdmcoKTsNCiAgICAgICAgICAgIHZhciBmeSA9IHkxPnkyP3kxLnRvc3VpdHN2ZygpOiB5Mi50b3N1aXRzdmcoKTsNCgkJCXZhciBvZmZ5ID0gTWF0aC5hYnMoeTEteTIpOwkJCQkJCQkJCQkgIA0KICAgICAgICAgICAgdmFyIHRyc3RyID0gICd0cmFuc2xhdGUoJytmeCsnLCcrZnkrJyknOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JyxvZmZ5LnRvU3RyaW5nKCkpOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCcxNicpOw0KICAgICAgICAgICAgcG9wdXBSLnNldEF0dHJpYnV0ZSgneScsKC1vZmZ5KS50b1N0cmluZygpKTsNCiAgICAgICAgICAgIHBvcHVwUi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCd0cmFuc3BhcmVudCcpOw0KICAgICAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQocG9wdXBSKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB2YXIgYWw9YS5sZW5ndGg7DQogICAgZm9yKHZhciBqPTA7ajxhbDtqKyspew0KICAgICAgICBsaW5rYXJyLnB1c2goYVtqXS5saW5rKTsNCiAgICAgICAgZGVzY2Fyci5wdXNoKGFbal0uZGVzYyk7DQogICAgfQ0KICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJyx0cnN0cik7DQogICAgdmFyIG1heD1nZXRtYXhsZW4obGlua2FycixkZXNjYXJyKTsNCiAgICBmb3IodmFyIGs9MDtrPGFsO2srKyl7DQogICAgICAgIHZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdhJyk7DQogICAgICAgIHZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCdyZWN0Jyk7DQogICAgICAgIHZhciBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIHZhciBmPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCd0ZXh0Jyk7DQogICAgICAgIGlmKGlzTmFOKGxpbmthcnJba10pKXsNCiAgICAgICAgICAgIGMuc2V0QXR0cmlidXRlTlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgInhsaW5rIiwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiKTsNCiAgICAgICAgICAgIGMuc2V0QXR0cmlidXRlTlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAiaHJlZiIsIGxpbmthcnJba10pOw0KICAgICAgICAgICAgYy5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsJ19ibGFuaycpOw0KICAgICAgICAgICAgZS50ZXh0Q29udGVudD1saW5rYXJyW2tdOw0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIGUudGV4dENvbnRlbnQ9J1BhZ2UtJytsaW5rYXJyW2tdOw0KICAgICAgICAgICAgYy5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCAieGxpbmsiLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIpOw0KICAgICAgICAgICAgYy5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICJocmVmIiwgIiMiK2xpbmthcnJba10pOw0KICAgICAgICB9DQogICAgICAgIGQuc2V0QXR0cmlidXRlKCd3aWR0aCcsbWF4KzEwKTsNCiAgICAgICAgZC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsJzMzJyk7DQogICAgICAgIGQuc2V0QXR0cmlidXRlKCdzdHJva2UnLCcjOTk5OTk5Jyk7DQogICAgICAgIGQuc2V0QXR0cmlidXRlKCdmaWxsJywnd2hpdGUnKTsNCiAgICAgICAgZC5zZXRBdHRyaWJ1dGUoJ3knLDMzKmspOw0KICAgICAgICBmLnRleHRDb250ZW50PWRlc2NhcnJba107DQogICAgICAgIGYuc3R5bGUuZm9udFNpemU9JzEycHgnOw0KICAgICAgICBmLnN0eWxlLmZvbnRXZWlnaHQ9J2JvbGQnOw0KICAgICAgICBmLnNldEF0dHJpYnV0ZSgneCcsNSk7DQogICAgICAgIGYuc2V0QXR0cmlidXRlKCd5JywzMyprKzEyKTsNCiAgICAgICAgZS5zdHlsZS5mb250U2l6ZT0nMTJweCc7DQogICAgICAgIGUuc2V0QXR0cmlidXRlKCd5JywzMyprKzI4KTsNCiAgICAgICAgZS5zZXRBdHRyaWJ1dGUoJ3gnLDUpOw0KICAgICAgICBjLmFwcGVuZENoaWxkKGQpOw0KICAgICAgICBjLmFwcGVuZENoaWxkKGYpOw0KICAgICAgICBjLmFwcGVuZENoaWxkKGUpOw0KICAgICAgICBjLm9ubW91c2VvdmVyPWZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvcigncmVjdCcpLnN0eWxlLmZpbGw9JyNlMWUxZmYnDQogICAgICAgIH07DQogICAgICAgIGMub25tb3VzZW91dD1mdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ3JlY3QnKS5zdHlsZS5maWxsPSd3aGl0ZScNCiAgICAgICAgfTsNCiAgICAgICAgcG9wdXAuYXBwZW5kQ2hpbGQoYyk7DQogICAgfQ0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgIHBvcHVwLnNldEF0dHJpYnV0ZSgnaHlwZXJsaW5rJywnJyk7DQogICAgcG9wdXAuc2V0QXR0cmlidXRlKCdlZDpsaW5raWQnLGxpbmtzW2ldLnBhcmVudE5vZGUuaWQpOw0KICAgIHBvcHVwLm9ubW91c2VvdmVyPWZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5PSdibG9jayc7DQogICAgfTsNCiAgICBwb3B1cC5vbmNsaWNrPWZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICB9Ow0KICAgIHBvcHVwLm9ubW91c2VvdXQ9ZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXk9J25vbmUnOw0KICAgIH07DQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N2Zy1jb250YWluZXIgPiBzdmcnKS5hcHBlbmRDaGlsZChwb3B1cCk7DQogICAgbGlua3NbaV0ub25tb3VzZW92ZXI9ZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbGlua2lkPXRoaXMucGFyZW50Tm9kZS5pZDsNCiAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yKCdyZWN0Jykuc3R5bGUuZGlzcGxheT0nYmxvY2snOw0KICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJnW2VkXFw6bGlua2lkPSciK2xpbmtpZCsiJ11baHlwZXJsaW5rXSIpLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsNCiAgICB9DQogICAgbGlua3NbaV0ub25tb3VzZW91dD1mdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBsaW5raWQ9dGhpcy5wYXJlbnROb2RlLmlkOw0KICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ3JlY3QnKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZ1tlZFxcOmxpbmtpZD0nIitsaW5raWQrIiddW2h5cGVybGlua10iKS5zdHlsZS5kaXNwbGF5PSdub25lJzsNCiAgICB9DQp9DQovLy0taHlwZXJsaW5rDQovL2luaXRpYWxpemUtLQ0KdmFyIHNoYXBlPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2dbZWRcXDp0b2d0b3BpY2lkXScpOw0KdmFyIG1JZD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdnW2VkXFw6dG9waWN0eXBlXScpOw0KdmFyIGRhdGFUcmVlPXt9Ow0KdmFyIGV4dHJhUmVsYT17fTsNCnZhciBjaGVja0lEPScnOw0KZm9yKHZhciBpPTA7aTxtSWQubGVuZ3RoO2krKyl7DQogICAgdmFyIHR5cGU9bUlkW2ldLmdldEF0dHJpYnV0ZSgnZWQ6dG9waWN0eXBlJyk7DQogICAgdmFyIHNpZD1tSWRbaV0uaWQ7DQogICAgaWYodHlwZSE9PSdjYWxsb3V0Jyl7DQogICAgICAgIGluaXQoc2lkLGRhdGFUcmVlKQ0KICAgIH0NCn0NCmZ1bmN0aW9uIGluaXQoaWQsIG9iaikgew0KICAgIHZhciBjaGlsZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJnW2VkXFw6cGFyZW50aWQ9JyIgKyBpZCArICInXTpub3QoW2VkXFw6dG9waWN0eXBlXSkiKTsNCiAgICB2YXIgY2FsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJnW2VkXFw6cGFyZW50aWQ9JyIgKyBpZCArICInXVtlZFxcOnRvcGljdHlwZV0iKTsNCiAgICB2YXIgc3VtbWFyeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInBhdGhbZWRcXDpwYXJlbnRpZCo9JyIgKyBpZCArICInXVtlZFxcOnR5cGU9J3N1bW1hcnknXSIpOw0KICAgIHZhciBib3VuZGFyeT0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgicGF0aFtlZFxcOnBhcmVudGlkKj0nIiArIGlkICsgIiddW2VkXFw6dHlwZT0nYm91bmRhcnknXSIpOw0KICAgIHZhciByZWxhZnJvbT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJnW2VkXFw6ZnJvbWlkKj0nIiArIGlkICsgIiddW2VkXFw6dHlwZT0ncmVsYXRpb24nXSIpOw0KICAgIHZhciByZWxhdG89ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiZ1tlZFxcOnRvaWQqPSciICsgaWQgKyAiJ11bZWRcXDp0eXBlPSdyZWxhdGlvbiddIik7DQogICAgb2JqWyJtIiArIGlkXSA9IHt9Ow0KICAgIHZhciB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmdldEF0dHJpYnV0ZSgnZWQ6dG9waWN0eXBlJyk7DQogICAgdmFyIGl3PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5nZXRBdHRyaWJ1dGUoJ2VkOndpZHRoJyk7DQogICAgdmFyIGloPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5nZXRBdHRyaWJ1dGUoJ2VkOmhlaWdodCcpOw0KICAgIGlmICh0eXBlKSB7DQogICAgICAgIG9ialsibSIgKyBpZF0udHlwZSA9IHR5cGU7DQogICAgfQ0KICAgIGlmKGl3JiZpaCl7DQogICAgICAgIG9ialsibSIgKyBpZF0ud2lkdGggPWl3Ow0KICAgICAgICBvYmpbIm0iICsgaWRdLmhlaWdodCA9aWg7DQogICAgfQ0KICAgIGlmIChyZWxhZnJvbS5sZW5ndGggIT09IDApIHsNCiAgICAgICAgb2JqWyJtIiArIGlkXS5yZWxhZnJvbSA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlbGFmcm9tLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgaW5kZXhpZCA9IHJlbGFmcm9tW2ldLmlkOw0KICAgICAgICAgICAgdmFyIHRvaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbmRleGlkKS5nZXRBdHRyaWJ1dGUoJ2VkOnRvaWQnKTsNCiAgICAgICAgICAgIGlmIChleHRyYVJlbGFbaW5kZXhpZF0gPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGV4dHJhUmVsYVtpbmRleGlkXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgaWQ6IGluZGV4aWQsDQogICAgICAgICAgICAgICAgICAgIGZyb21pZDogaWQsDQogICAgICAgICAgICAgICAgICAgIHRvaWQ6IHRvaWQsDQogICAgICAgICAgICAgICAgICAgIGlzQzogZmFsc2UNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb2JqWyJtIiArIGlkXS5yZWxhZnJvbVtpbmRleGlkXT17fTsNCiAgICAgICAgICAgIG9ialsibSIgKyBpZF0ucmVsYWZyb20uZGlzcGxheT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnPydibG9jayc6J25vbmUnOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChyZWxhdG8ubGVuZ3RoICE9PSAwKSB7DQogICAgICAgIG9ialsibSIgKyBpZF0ucmVsYXRvID0ge307DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVsYXRvLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgaW5kZXhpZD1yZWxhdG9baV0uaWQ7DQogICAgICAgICAgICB2YXIgZnJvbWlkPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZGV4aWQpLmdldEF0dHJpYnV0ZSgnZWQ6ZnJvbWlkJyk7DQogICAgICAgICAgICBpZihleHRyYVJlbGFbaW5kZXhpZF0gPT09IHVuZGVmaW5lZCl7DQogICAgICAgICAgICAgICAgZXh0cmFSZWxhW2luZGV4aWRdPXsNCiAgICAgICAgICAgICAgICAgICAgaWQ6aW5kZXhpZCwNCiAgICAgICAgICAgICAgICAgICAgZnJvbWlkOmZyb21pZCwNCiAgICAgICAgICAgICAgICAgICAgdG9pZDppZCwNCiAgICAgICAgICAgICAgICAgICAgaXNDOmZhbHNlDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9ialsibSIgKyBpZF0ucmVsYXRvW2luZGV4aWRdPXt9Ow0KICAgICAgICAgICAgb2JqWyJtIiArIGlkXS5yZWxhdG8uZGlzcGxheT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnPydibG9jayc6J25vbmUnOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChjaGlsZHMubGVuZ3RoICE9PSAwKSB7DQogICAgICAgIG9ialsibSIgKyBpZF0uY2hpbGQgPSB7fTsNCiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImdbZWRcXDp0b2d0b3BpY2lkPSciICsgaWQgKyAiJ10iKSkgew0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZ1tlZFxcOnRvZ3RvcGljaWQ9JyIgKyBpZCArICInXSIpLmNoaWxkTm9kZXNbMF0uZ2V0QXR0cmlidXRlKCd4bGluazpocmVmJykpOw0KICAgICAgICAgICAgdmFyIHRvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImdbZWRcXDp0b2d0b3BpY2lkPSciICsgaWQgKyAiJ10iKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndXNlJylbMF0uZ2V0QXR0cmlidXRlKCd4bGluazpocmVmJykuc2xpY2UoMSk7DQogICAgICAgICAgICBvYmpbIm0iICsgaWRdLnRvZ3R5cGUgPSB0b2c7DQogICAgICAgIH0NCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBjaWQgPSBjaGlsZHNbaV0uaWQ7DQogICAgICAgICAgICBpbml0KGNpZCwgb2JqWyJtIiArIGlkXS5jaGlsZCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGNhbGxzLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICBvYmpbIm0iICsgaWRdLmNhbGwgPSB7fTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYWxscy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIGNpZCA9IGNhbGxzW2ldLmlkOw0KICAgICAgICAgICAgaW5pdChjaWQsIG9ialsibSIgKyBpZF0uY2FsbCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGJvdW5kYXJ5Lmxlbmd0aCAhPT0gMCkgew0KICAgICAgICBvYmpbIm0iICsgaWRdLmJvdW5kYXJ5ID0ge307DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm91bmRhcnkubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBjaWQgPWJvdW5kYXJ5W2ldLmlkOw0KICAgICAgICAgICAgaW5pdChjaWQsIG9ialsibSIgKyBpZF0uYm91bmRhcnkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChzdW1tYXJ5Lmxlbmd0aCAhPT0gMCkgew0KICAgICAgICBvYmpbIm0iICsgaWRdLnN1bW1hcnkgPSB7fTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdW1tYXJ5Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgY2lkID0gc3VtbWFyeVtpXS5pZDsNCiAgICAgICAgICAgIGluaXQoY2lkLCBvYmpbIm0iICsgaWRdLnN1bW1hcnkpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLy8tLWluaXRpYWxpemUNCi8vdG9nZ2xlZGlzcGxheS0tDQp2YXIgY2hhaW5BcnI9W107DQpmdW5jdGlvbiBnZXRjaGFpbihpZCl7DQogICAgY2hhaW5BcnIudW5zaGlmdCgnbScraWQpOw0KICAgIHZhciBwYXJlbnQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmdldEF0dHJpYnV0ZSgnZWQ6cGFyZW50aWQnKTsNCiAgICBpZighcGFyZW50KXsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCglpZihwYXJlbnQubWF0Y2goL1wsLykpew0KICAgICAgICBwYXJlbnQgPSBwYXJlbnQubWF0Y2goL1xkKyg/PVwsKS8pWzBdDQogICAgfQ0KICAgIGdldGNoYWluKHBhcmVudCk7DQp9DQpmdW5jdGlvbiBnZXRvYmooaWQpIHsNCiAgICBjaGFpbkFycj1bXTsNCiAgICBnZXRjaGFpbihpZCk7DQogICAgdmFyIG1haW49Y2hhaW5BcnJbMF07DQogICAgaWYoY2hhaW5BcnIubGVuZ3RoPjEpew0KICAgICAgICB2YXIgb2JqPWRhdGFUcmVlW21haW5dOw0KICAgICAgICAvLyBjb25zb2xlLmxvZyhjaGFpbkFycik7DQogICAgICAgIGZvcih2YXIgaT0xO2k8Y2hhaW5BcnIubGVuZ3RoO2krKykgew0KICAgICAgICAgICAgdmFyIGEgPSBjaGFpbkFycltpXTsNCiAgICAgICAgICAgIGZvcih2YXIgaj0wO2o8T2JqZWN0LmtleXMob2JqKS5sZW5ndGg7aisrKXsNCiAgICAgICAgICAgICAgICB2YXIgY29iaj0gb2JqW09iamVjdC5rZXlzKG9iailbal1dW2FdOw0KICAgICAgICAgICAgICAgIGlmKGNvYmopew0KICAgICAgICAgICAgICAgICAgICBvYmo9Y29iajsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG9iag0KICAgIH1lbHNlew0KICAgICAgICB2YXIgb2JqPWRhdGFUcmVlW21haW5dOw0KICAgICAgICByZXR1cm4gb2JqDQogICAgfQ0KDQp9DQpmb3IodmFyIGk9MDtpPHNoYXBlLmxlbmd0aDtpKyspew0KICAgIHNoYXBlW2ldLm9uY2xpY2s9ZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgaWQ9TnVtYmVyKHRoaXMuZ2V0QXR0cmlidXRlKCdlZDp0b2d0b3BpY2lkJykpOw0KICAgICAgICB2YXIgb2JqPWdldG9iaihpZCk7DQoNCiAgICAgICAgdmFyIHR5cGU9b2JqLnRvZ3R5cGU9PT0nbWludXMnPydwbHVzJzonbWludXMnOw0KICAgICAgICB2YXIgZGlzcGxheT1vYmoudG9ndHlwZT09PSdtaW51cyc/J25vbmUnOidibG9jayc7DQogICAgICAgIHRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3VzZScpWzBdLnNldEF0dHJpYnV0ZSgneGxpbms6aHJlZicsJyMnK3R5cGUpOw0KICAgICAgICBvYmoudG9ndHlwZT10eXBlOw0KICAgICAgICBjaGVja0lEPW9iajsNCg0KICAgICAgICB1dGQob2JqLGlkLGRpc3BsYXkpOw0KICAgICAgICBleHRyYVJlbGFGaW4oKTsNCiAgICB9DQp9DQpmdW5jdGlvbiB1dGQob2JqLGlkLHNob3csb2MpIHsNCg0KICAgIHZhciBwc2hvdz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSE9PSAnbm9uZSc/J2Jsb2NrJzonbm9uZSc7DQogICAgaWYgKG9iai5yZWxhZnJvbSl7DQogICAgICAgIGlmKG9iai5yZWxhZnJvbS5kaXNwbGF5IT09IHBzaG93KXsNCiAgICAgICAgICAgIHZhciByZWxhZnJvbXM9T2JqZWN0LmtleXMob2JqLnJlbGFmcm9tKTsNCiAgICAgICAgICAgIHJlbGFmcm9tcy5zcGxpY2UocmVsYWZyb21zLmluZGV4T2YoJ2Rpc3BsYXknKSwxKTsNCiAgICAgICAgICAgIGZvcih2YXIgaz0wO2s8cmVsYWZyb21zLmxlbmd0aDtrKyspew0KICAgICAgICAgICAgICAgIHZhciBkPXJlbGFmcm9tc1trXTsNCiAgICAgICAgICAgICAgICBleHRyYVJlbGFbZF0uaXNDPXRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvYmoucmVsYWZyb20uZGlzcGxheSA9IHBzaG93Ow0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChvYmoucmVsYXRvKXsNCiAgICAgICAgaWYob2JqLnJlbGF0by5kaXNwbGF5IT09IHBzaG93KXsNCiAgICAgICAgICAgIHZhciByZWxhdG9zPU9iamVjdC5rZXlzKG9iai5yZWxhdG8pOw0KICAgICAgICAgICAgcmVsYXRvcy5zcGxpY2UocmVsYXRvcy5pbmRleE9mKCdkaXNwbGF5JyksMSk7DQogICAgICAgICAgICBmb3IodmFyIGs9MDtrPHJlbGF0b3MubGVuZ3RoO2srKyl7DQogICAgICAgICAgICAgICAgdmFyIGQ9cmVsYXRvc1trXTsNCiAgICAgICAgICAgICAgICBleHRyYVJlbGFbZF0uaXNDPXRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvYmoucmVsYXRvLmRpc3BsYXkgPSBwc2hvdzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZihvYmouY2FsbCl7DQogICAgICAgIHZhciBjYWxscz1PYmplY3Qua2V5cyhvYmouY2FsbCk7DQogICAgICAgIGlmKGNoZWNrSUQhPT1vYmopew0KICAgICAgICAgICAgZm9yKHZhciBpPTA7aSA8IGNhbGxzLmxlbmd0aDtpKyspew0KICAgICAgICAgICAgICAgIHZhciBhPWNhbGxzW2ldLnNsaWNlKDEpOw0KICAgICAgICAgICAgICAgIHZhciBiPW9iai5jYWxsW2NhbGxzW2ldXTsNCiAgICAgICAgICAgICAgICB2YXIgYz1iLnRvZ3R5cGU7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYSkuc3R5bGUuZGlzcGxheT1zaG93Ow0KICAgICAgICAgICAgICAgIGlmIChiLnJlbGFmcm9tJiYhYyl7DQogICAgICAgICAgICAgICAgICAgIGlmKGIucmVsYWZyb20uZGlzcGxheSE9PSBzaG93KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWxhZnJvbXM9T2JqZWN0LmtleXMoYi5yZWxhZnJvbSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZWxhZnJvbXMuc3BsaWNlKHJlbGFmcm9tcy5pbmRleE9mKCdkaXNwbGF5JyksMSk7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGs9MDtrPHJlbGFmcm9tcy5sZW5ndGg7aysrKXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZD1yZWxhZnJvbXNba107DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFSZWxhW2RdLmlzQz10cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYi5yZWxhZnJvbS5kaXNwbGF5ID0gc2hvdzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYi5yZWxhdG8mJiFjKXsNCiAgICAgICAgICAgICAgICAgICAgaWYoYi5yZWxhdG8uZGlzcGxheSE9PSBzaG93KXsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWxhdG9zPU9iamVjdC5rZXlzKGIucmVsYXRvKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0b3Muc3BsaWNlKHJlbGF0b3MuaW5kZXhPZignZGlzcGxheScpLDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBrPTA7azxyZWxhdG9zLmxlbmd0aDtrKyspew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkPXJlbGF0b3Nba107DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFSZWxhW2RdLmlzQz10cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYi5yZWxhdG8uZGlzcGxheSA9IHNob3c7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoYyl7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImdbZWRcXDp0b2d0b3BpY2lkPSciK2ErIiddIikuc3R5bGUuZGlzcGxheT1zaG93Ow0KICAgICAgICAgICAgICAgICAgICBpZihjPT09J21pbnVzJyl7DQogICAgICAgICAgICAgICAgICAgICAgICB1dGQoYixhLHNob3cpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKChiLmNhbGx8fGIuYm91bmRhcnl8fGIuc3VtbWFyeSkmJmM9PT0ncGx1cycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdyx0cnVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmKGIuY2FsbCYmIWMpIHsNCiAgICAgICAgICAgICAgICAgICAgdXRkKGIsYSxzaG93LHRydWUpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChiLnN1bW1hcnkmJiFjKSB7DQogICAgICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGIuYm91bmRhcnkmJiFjKSB7DQogICAgICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdykNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZihvYmouc3VtbWFyeSl7DQogICAgICAgIHZhciBzdW1tYXJ5cz1PYmplY3Qua2V5cyhvYmouc3VtbWFyeSk7DQogICAgICAgIGlmKChjaGVja0lEIT09b2JqJiYob2JqLnRvZ3R5cGU9PT0nbWludXMnfHwhb2JqLnRvZ3R5cGUpKXx8Y2hlY2tJRD09PW9iail7DQogICAgICAgICAgICBmb3IodmFyIGk9MDtpPHN1bW1hcnlzLmxlbmd0aDtpKyspew0KICAgICAgICAgICAgICAgIHZhciBhPXN1bW1hcnlzW2ldLnNsaWNlKDEpOw0KCQkJCXZhciBvc3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKS5nZXRBdHRyaWJ1dGUoJ2VkOnBhcmVudGlkJyk7DQogICAgICAgICAgICAgICAgaWYob3NwLm1hdGNoKC9cLC8pKXsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG9zcGEgPSBvc3Auc3BsaXQoJywnKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG9zcEw9MDsNCg0KICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGo9MDtqPG9zcGEubGVuZ3RoO2orKyl7DQogICAgICAgICAgICAgICAgICAgICAgICBpZihzaG93ID09ICdub25lJyl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3NwYVtqXSkuc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3NwTCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJyl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvc3BMKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmKG9zcEwgIT09IG9zcGEubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBiPW9iai5zdW1tYXJ5W3N1bW1hcnlzW2ldXTsNCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKS5zdHlsZS5kaXNwbGF5PXNob3c7DQovLyAgICAgICAgICAgICAgICBpZihjKXsNCi8vICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJnW2VkXFw6dG9ndG9waWNpZD0nIithKyInXSIpLnN0eWxlLmRpc3BsYXk9c2hvdzsNCi8vICAgICAgICAgICAgICAgICAgICBpZihjPT09J21pbnVzJyl7DQovLyAgICAgICAgICAgICAgICAgICAgICAgIHV0ZChiLHNob3cpDQovLyAgICAgICAgICAgICAgICAgICAgfQ0KLy8gICAgICAgICAgICAgICAgICAgIGlmIChiLmNhbGwmJmM9PT0ncGx1cycpIHsNCi8vICAgICAgICAgICAgICAgICAgICAgICAgdXRkKGIsc2hvdyx0cnVlKQ0KLy8gICAgICAgICAgICAgICAgICAgIH0NCi8vICAgICAgICAgICAgICAgIH0NCi8vICAgICAgICAgICAgICAgIGlmKGIuY2FsbCYmIWMpIHsNCi8vICAgICAgICAgICAgICAgICAgICB1dGQoYixzaG93LHRydWUpDQovLyAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXMoYikubGVuZ3RoIT09MCl7DQogICAgICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYob2JqLmJvdW5kYXJ5KXsNCiAgICAgICAgdmFyIGJvdW5kYXJ5cz1PYmplY3Qua2V5cyhvYmouYm91bmRhcnkpOw0KICAgICAgICBpZihjaGVja0lEIT09b2JqKXsNCiAgICAgICAgICAgIGZvcih2YXIgaT0wO2k8Ym91bmRhcnlzLmxlbmd0aDtpKyspew0KICAgICAgICAgICAgICAgIHZhciBhPWJvdW5kYXJ5c1tpXS5zbGljZSgxKTsNCiAgICAgICAgICAgICAgICB2YXIgYj1vYmouYm91bmRhcnlbYm91bmRhcnlzW2ldXTsNCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhKTsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKS5zdHlsZS5kaXNwbGF5PXNob3c7DQovLyAgICAgICAgICAgICAgICBpZihjKXsNCi8vICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJnW2VkXFw6dG9ndG9waWNpZD0nIithKyInXSIpLnN0eWxlLmRpc3BsYXk9c2hvdzsNCi8vICAgICAgICAgICAgICAgICAgICBpZihjPT09J21pbnVzJyl7DQovLyAgICAgICAgICAgICAgICAgICAgICAgIHV0ZChiLHNob3cpDQovLyAgICAgICAgICAgICAgICAgICAgfQ0KLy8gICAgICAgICAgICAgICAgICAgIGlmIChiLmNhbGwmJmM9PT0ncGx1cycpIHsNCi8vICAgICAgICAgICAgICAgICAgICAgICAgdXRkKGIsc2hvdyx0cnVlKQ0KLy8gICAgICAgICAgICAgICAgICAgIH0NCi8vICAgICAgICAgICAgICAgIH0NCi8vICAgICAgICAgICAgICAgIGlmKGIuY2FsbCYmIWMpIHsNCi8vICAgICAgICAgICAgICAgICAgICB1dGQoYixzaG93LHRydWUpDQovLyAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXMoYikubGVuZ3RoIT09MCl7DQogICAgICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaWYoIW9jJiZvYmouY2hpbGQpIHsNCiAgICAgICAgdmFyIGNoaWxkcyA9IE9iamVjdC5rZXlzKG9iai5jaGlsZCk7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgYSA9IGNoaWxkc1tpXS5zbGljZSgxKTsNCiAgICAgICAgICAgIHZhciBiID0gb2JqLmNoaWxkW2NoaWxkc1tpXV07DQogICAgICAgICAgICB2YXIgYyA9IGIudG9ndHlwZTsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEpLnN0eWxlLmRpc3BsYXkgPSBzaG93Ow0KCQkJdmFyIHRTUGF0aCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInBhdGhbZWRcXDp0b3N1cGVyaWQ9JyIrYSsiJ10iKTsNCiAgICAgICAgICAgIGlmKHRTUGF0aCl7DQogICAgICAgICAgICAgICAgdFNQYXRoLnN0eWxlLmRpc3BsYXkgPSBzaG93Ow0KICAgICAgICAgICAgfQ0KCQkJdmFyIG5vdGVUaXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJnW2VkXFw6bm90ZXRvPSciK2ErIiddIik7DQogICAgICAgICAgICBpZihub3RlVGlwKXsNCiAgICAgICAgICAgICAgICBub3RlVGlwLnN0eWxlLmRpc3BsYXkgPSBzaG93Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGIucmVsYWZyb20mJiFjKXsNCiAgICAgICAgICAgICAgICBpZihiLnJlbGFmcm9tLmRpc3BsYXkhPT0gc2hvdyl7DQogICAgICAgICAgICAgICAgICAgIHZhciByZWxhZnJvbXM9T2JqZWN0LmtleXMoYi5yZWxhZnJvbSk7DQogICAgICAgICAgICAgICAgICAgIHJlbGFmcm9tcy5zcGxpY2UocmVsYWZyb21zLmluZGV4T2YoJ2Rpc3BsYXknKSwxKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBrPTA7azxyZWxhZnJvbXMubGVuZ3RoO2srKyl7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZD1yZWxhZnJvbXNba107DQogICAgICAgICAgICAgICAgICAgICAgICBleHRyYVJlbGFbZF0uaXNDPXRydWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYi5yZWxhZnJvbS5kaXNwbGF5ID0gc2hvdzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYi5yZWxhdG8mJiFjKXsNCiAgICAgICAgICAgICAgICBpZihiLnJlbGF0by5kaXNwbGF5IT09IHNob3cpew0KICAgICAgICAgICAgICAgICAgICB2YXIgcmVsYXRvcz1PYmplY3Qua2V5cyhiLnJlbGF0byk7DQogICAgICAgICAgICAgICAgICAgIHJlbGF0b3Muc3BsaWNlKHJlbGF0b3MuaW5kZXhPZignZGlzcGxheScpLDEpOw0KICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGs9MDtrPHJlbGF0b3MubGVuZ3RoO2srKyl7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZD1yZWxhdG9zW2tdOw0KICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFSZWxhW2RdLmlzQz10cnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGIucmVsYXRvLmRpc3BsYXkgPSBzaG93Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChjKSB7DQogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZ1tlZFxcOnRvZ3RvcGljaWQ9JyIgKyBhICsgIiddIikuc3R5bGUuZGlzcGxheSA9IHNob3c7DQogICAgICAgICAgICAgICAgaWYgKGMgPT09ICdtaW51cycpIHsNCiAgICAgICAgICAgICAgICAgICAgdXRkKGIsYSxzaG93KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoKGIuY2FsbHx8Yi5ib3VuZGFyeXx8Yi5zdW1tYXJ5KSYmYz09PSdwbHVzJykgew0KICAgICAgICAgICAgICAgICAgICB1dGQoYixhLHNob3csdHJ1ZSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYi5jYWxsJiYhYykgew0KICAgICAgICAgICAgICAgIHV0ZChiLGEsc2hvdyx0cnVlKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGIuc3VtbWFyeSYmIWMpIHsNCiAgICAgICAgICAgICAgICB1dGQoYixhLHNob3cpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYi5ib3VuZGFyeSYmIWMpIHsNCiAgICAgICAgICAgICAgICB1dGQoYixhLHNob3cpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGV4dHJhUmVsYUZpbigpIHsNCiAgICB2YXIgZXh0cmFrZXlzPU9iamVjdC5rZXlzKGV4dHJhUmVsYSk7DQogICAgZm9yKHZhciBpPTA7aTxleHRyYWtleXMubGVuZ3RoO2krKyl7DQogICAgICAgIHZhciBleHRyYU9iaj1leHRyYVJlbGFbZXh0cmFrZXlzW2ldXTsNCiAgICAgICAgaWYoZXh0cmFPYmouaXNDID09PSB0cnVlKXsNCiAgICAgICAgICAgIHZhciBmc2hvdz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChleHRyYU9iai5mcm9taWQpLnN0eWxlLmRpc3BsYXkgIT09J25vbmUnPyB0cnVlOiBmYWxzZTsNCiAgICAgICAgICAgIHZhciB0c2hvdz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChleHRyYU9iai50b2lkKS5zdHlsZS5kaXNwbGF5ICE9PSdub25lJz8gdHJ1ZTogZmFsc2U7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChleHRyYU9iai5pZCkuc3R5bGUuZGlzcGxheT1mc2hvdyAmJiB0c2hvdz8gJ2Jsb2NrJzogJ25vbmUnOw0KICAgICAgICAgICAgZXh0cmFSZWxhW2V4dHJha2V5c1tpXV0uaXNDID0gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQp9'))</script>
  </body>
</html>
